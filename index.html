<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>¬´rba | fit¬ª</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#1e293b">
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='0.9em' font-size='90'%3Eüí™%3C/text%3E%3C/svg%3E">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .sticky-header {
            position: sticky;
            top: 0;
            z-index: 50;
            background: linear-gradient(to bottom right, rgb(15, 23, 42), rgb(30, 41, 59));
        }
        .muscle-tag {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.7rem;
            margin-left: 4px;
            opacity: 0.8;
        }
        .primary-muscle {
            background-color: rgba(59, 130, 246, 0.3);
            border: 1px solid rgba(59, 130, 246, 0.5);
        }
        .secondary-muscle {
            background-color: rgba(156, 163, 175, 0.2);
            border: 1px solid rgba(156, 163, 175, 0.3);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-900 to-slate-800 text-white min-h-screen">
    <div id="app"></div>

    <script>
        function getCurrentWeek() {
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            // Week 0: Oct 11-12, 2025 (Saturday-Sunday)
            // Week 1: Oct 13-19, 2025 (Monday starts)
            const week0Start = new Date(2025, 9, 11); // Month is 0-indexed, so 9 = October
            const week1Start = new Date(2025, 9, 13); // Monday Oct 13
            
            week0Start.setHours(0, 0, 0, 0);
            week1Start.setHours(0, 0, 0, 0);
            
            if (today < week0Start) return 0;
            if (today >= week0Start && today < week1Start) return 0;
            
            const diffTime = today - week1Start;
            const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
            const weekNum = Math.floor(diffDays / 7) + 1;
            
            return Math.max(1, Math.min(16, weekNum));
        }

        const state = {
            currentWeek: parseInt(localStorage.getItem('lastWeek')) || getCurrentWeek(),
            selectedDay: null,
            view: 'overview',
            completedExercises: JSON.parse(localStorage.getItem('workoutProgress') || '{}'),
            exerciseWeights: JSON.parse(localStorage.getItem('exerciseWeights') || '{}'),
            supplementLog: JSON.parse(localStorage.getItem('supplementLog') || '{}'),
            editingSet: null,
            tempWeight: ''
        };

        function saveState() {
            localStorage.setItem('workoutProgress', JSON.stringify(state.completedExercises));
            localStorage.setItem('exerciseWeights', JSON.stringify(state.exerciseWeights));
            localStorage.setItem('supplementLog', JSON.stringify(state.supplementLog));
            localStorage.setItem('lastWeek', state.currentWeek.toString());
        }

        function getWeekDates(week) {
            // Week 0: Saturday Oct 11 - Sunday Oct 12, 2025
            // Week 1: Monday Oct 13 - Sunday Oct 19, 2025
            // Week 2: Monday Oct 20 - Sunday Oct 26, 2025, etc.
            
            if (week === 0) {
                return {
                    saturday: new Date(2025, 9, 11),
                    sunday: new Date(2025, 9, 12)
                };
            }
            
            // Week 1 starts on Monday, Oct 13
            const week1Monday = new Date(2025, 9, 13);
            const daysFromWeek1 = (week - 1) * 7;
            
            const monday = new Date(week1Monday);
            monday.setDate(week1Monday.getDate() + daysFromWeek1);
            
            return {
                monday: new Date(monday),
                tuesday: new Date(monday.getTime() + 86400000),
                wednesday: new Date(monday.getTime() + 172800000),
                thursday: new Date(monday.getTime() + 259200000),
                friday: new Date(monday.getTime() + 345600000),
                saturday: new Date(monday.getTime() + 432000000),
                sunday: new Date(monday.getTime() + 518400000)
            };
        }

        function formatDate(date) {
            return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
        }

        function getWeekDateRange(week) {
            const dates = getWeekDates(week);
            if (week === 0) {
                return `${formatDate(dates.saturday)} - ${formatDate(dates.sunday)}`;
            }
            return `${formatDate(dates.monday)} - ${formatDate(dates.sunday)}`;
        }

        // Helper function to check if collagen should be taken today
        function shouldTakeCollagenToday() {
            const today = new Date();
            const startDate = new Date(2025, 9, 11); // Oct 11, 2025 - start of program
            const daysSinceStart = Math.floor((today - startDate) / (1000 * 60 * 60 * 24));
            return daysSinceStart % 2 === 0; // Every other day
        }

        const supplementSchedule = {
            preworkout: {
                time: '6:00 AM',
                note: 'Before training',
                supplements: [
                    { name: 'Beta-Alanine', dose: '3.2g (4 caps)', icon: '‚ö°', conditional: true }
                ]
            },
            morning: {
                time: '8:30 AM',
                note: 'Post-workout',
                supplements: [
                    { name: 'Whey Protein', dose: '2 scoops (50g)', icon: 'ü•§' },
                    { name: 'Creatine', dose: '5g', icon: 'üí™' },
                    { name: 'Omega-3', dose: '1 cap', icon: 'üêü' },
                    { name: 'Vitamin D3+K2', dose: '4000IU+100mcg', icon: '‚òÄÔ∏è' },
                    { name: 'B-Complex', dose: '1 cap', icon: 'üîã' },
                    { name: 'Vitamin C', dose: '500mg', icon: 'üçä' }
                ]
            },
            afternoon: {
                time: '3:00 PM',
                note: 'Mid-day (every other day)',
                supplements: [
                    { name: 'Collagen', dose: '1 scoop', icon: 'ü¶¥', conditional: true, checkFunction: shouldTakeCollagenToday }
                ]
            },
            evening: {
                time: '9:30 PM',
                note: 'Before bed',
                supplements: [
                    { name: 'Magnesium', dose: '240mg', icon: 'üò¥' },
                    { name: 'Zinc', dose: '30mg', icon: 'üõ°Ô∏è' },
                    { name: 'Ashwagandha', dose: '500mg', icon: 'üßò' }
                ]
            }
        };

        // Muscle group definitions for exercises
        const muscleMappings = {
            'Box Jumps': { primary: ['Quads'], secondary: ['Glutes', 'Calves'] },
            'Goblet Squats': { primary: ['Quads', 'Glutes'], secondary: ['Core'] },
            'Single-Leg Step-ups': { primary: ['Quads', 'Glutes'], secondary: ['Balance'] },
            'KB Swings': { primary: ['Glutes', 'Hamstrings'], secondary: ['Core', 'Shoulders'] },
            'Walking Lunges': { primary: ['Quads', 'Glutes'], secondary: ['Balance'] },
            'Slider Leg Curls': { primary: ['Hamstrings'], secondary: ['Glutes'] },
            'Bulgarian Split Squats': { primary: ['Quads', 'Glutes'], secondary: ['Balance'] },
            'Single-Leg RDL': { primary: ['Hamstrings', 'Glutes'], secondary: ['Core'] },
            'Double KB Front Squats': { primary: ['Quads', 'Glutes'], secondary: ['Core'] },
            'Heavy Goblet Squats': { primary: ['Quads', 'Glutes'], secondary: ['Core'] },
            
            'DB Floor Press': { primary: ['Chest'], secondary: ['Triceps', 'Shoulders'] },
            'KB Rows': { primary: ['Back'], secondary: ['Biceps'] },
            'KB Shoulder Press': { primary: ['Shoulders'], secondary: ['Triceps'] },
            'Push-ups': { primary: ['Chest'], secondary: ['Triceps', 'Core'] },
            'KB Upright Rows': { primary: ['Shoulders'], secondary: ['Traps'] },
            'Hammer Curls': { primary: ['Biceps'], secondary: ['Forearms'] },
            'Tricep Extensions': { primary: ['Triceps'], secondary: [] },
            'Bent-Over Rows': { primary: ['Back'], secondary: ['Biceps'] },
            'Lateral Raises': { primary: ['Shoulders'], secondary: [] },
            'Pike Push-ups': { primary: ['Shoulders'], secondary: ['Triceps'] },
            'KB Curls': { primary: ['Biceps'], secondary: [] },
            'Skull Crushers': { primary: ['Triceps'], secondary: [] },
            'Face Pulls': { primary: ['Rear Delts'], secondary: ['Traps'] },
            'Weighted Push-ups': { primary: ['Chest'], secondary: ['Triceps', 'Core'] },
            'Single-Arm Floor Press': { primary: ['Chest'], secondary: ['Triceps', 'Core'] },
            'Weighted Deficit Push-ups': { primary: ['Chest'], secondary: ['Triceps'] },
            'Explosive Push-ups (clap)': { primary: ['Chest', 'Power'], secondary: ['Triceps'] },
            'DB Floor Press (tempo)': { primary: ['Chest'], secondary: ['Triceps'] },
            'Heavy DB Press (floor)': { primary: ['Chest'], secondary: ['Triceps'] },
            
            'KB Clean & Press': { primary: ['Full Body'], secondary: ['Power'] },
            'Broad Jumps': { primary: ['Power', 'Legs'], secondary: [] },
            'Weighted Carries': { primary: ['Core', 'Grip'], secondary: ['Traps'] },
            'KB Snatches': { primary: ['Full Body'], secondary: ['Power'] },
            'Double KB Clean & Press': { primary: ['Full Body'], secondary: ['Power'] },
            'Depth Jumps': { primary: ['Power', 'Quads'], secondary: [] },
            'Broad Jumps (max distance)': { primary: ['Power', 'Legs'], secondary: [] },
            
            'Sprint Intervals': { primary: ['Cardio', 'Legs'], secondary: [] },
            'Stadium Stairs': { primary: ['Cardio', 'Quads'], secondary: ['Glutes'] },
            'Jump Rope HIIT': { primary: ['Cardio'], secondary: ['Calves'] },
            'Slider Mt Climbers': { primary: ['Core'], secondary: ['Shoulders'] },
            'Power Sprints': { primary: ['Speed', 'Legs'], secondary: [] },
            'Agility T-Drill': { primary: ['Agility'], secondary: ['Legs'] },
            'Lateral Bounds': { primary: ['Lateral Power'], secondary: ['Legs'] },
            'Jump Rope': { primary: ['Cardio'], secondary: ['Calves'] },
            'Weighted Stairs': { primary: ['Cardio', 'Quads'], secondary: ['Glutes'] },
            
            'Med Ball Slams': { primary: ['Core', 'Power'], secondary: ['Shoulders'] },
            'Plank Hold': { primary: ['Core'], secondary: [] },
            'Med Ball Twists': { primary: ['Obliques'], secondary: ['Core'] },
            'Dead Bugs': { primary: ['Core'], secondary: [] },
            'Burpees': { primary: ['Full Body'], secondary: ['Cardio'] },
            'High Plank Hold': { primary: ['Core'], secondary: ['Shoulders'] },
            'Ball Pikes': { primary: ['Core'], secondary: ['Shoulders'] },
            'Side Throws': { primary: ['Obliques'], secondary: ['Core'] },
            'Ball Rollouts': { primary: ['Core'], secondary: [] },
            'High Knees': { primary: ['Cardio'], secondary: ['Hip Flexors'] },
            'V-ups': { primary: ['Core'], secondary: [] },
            'Bicycle Crunches': { primary: ['Abs', 'Obliques'], secondary: [] }
        };

        function getMuscleGroups(exerciseName) {
            return muscleMappings[exerciseName] || { primary: [], secondary: [] };
        }

        function getPhase(week) {
            if (week === 0) return 0;
            if (week <= 4) return 1;
            if (week <= 8) return 2;
            if (week <= 12) return 3;
            return 4;
        }

        function getPhaseInfo(phase) {
            const phases = {
                0: { name: 'Prep Week', focus: 'Movement prep' },
                1: { name: 'Foundation', focus: 'Work capacity' },
                2: { name: 'Strength Building', focus: 'Progressive overload' },
                3: { name: 'Power & Hypertrophy', focus: 'Peak building' },
                4: { name: 'Peak Performance', focus: 'Max strength' }
            };
            return phases[phase];
        }

        const baseWorkouts = {
            monday: { 
                name: 'Lower Body', 
                duration: '65 min',
                location: 'home',
                equipmentNeeded: ['KB: 20, 35, 53', 'DB: 20', 'Sliders', 'Med Ball: 15'],
                exercises: [
                    { name: 'Dynamic Warm-up', sets: 1, reps: '8 min' },
                    { name: 'Box Jumps', sets: 3, reps: 8, rest: '90s', hasWeight: true, defaultWeight: 20 },
                    { name: 'Goblet Squats', sets: 4, reps: 15, rest: '90s', hasWeight: true, defaultWeight: 35 },
                    { name: 'Single-Leg Step-ups', sets: 3, reps: '12/side', rest: '75s', hasWeight: true, defaultWeight: 20 },
                    { name: 'KB Swings', sets: 4, reps: 20, rest: '75s', hasWeight: true, defaultWeight: 35 },
                    { name: 'Walking Lunges', sets: 3, reps: '20 steps', rest: '75s', hasWeight: true, defaultWeight: 20 },
                    { name: 'Slider Leg Curls', sets: 3, reps: 12, rest: '60s' },
                    { name: 'Med Ball Slams', sets: 3, reps: 15, rest: '45s', hasWeight: true, defaultWeight: 15 },
                    { name: 'Plank Hold', sets: 3, reps: '45s', rest: '30s' },
                    { name: 'Mobility Cool-down', sets: 1, reps: '5 min' }
                ]
            },
            tuesday: { 
                name: 'Upper Body', 
                duration: '70 min',
                location: 'home',
                equipmentNeeded: ['DB: 20-40', 'KB: 25, 35', 'Med Ball: 15'],
                exercises: [
                    { name: 'Dynamic Warm-up', sets: 1, reps: '8 min' },
                    { name: 'DB Floor Press', sets: 4, reps: 12, rest: '90s', hasWeight: true, defaultWeight: 35 },
                    { name: 'KB Rows', sets: 4, reps: '15/side', rest: '90s', hasWeight: true, defaultWeight: 35 },
                    { name: 'KB Shoulder Press', sets: 4, reps: 12, rest: '75s', hasWeight: true, defaultWeight: 25 },
                    { name: 'Push-ups', sets: 3, reps: 15, rest: '75s' },
                    { name: 'KB Upright Rows', sets: 3, reps: 15, rest: '60s', hasWeight: true, defaultWeight: 25 },
                    { name: 'Hammer Curls', sets: 3, reps: 15, rest: '60s', hasWeight: true, defaultWeight: 20 },
                    { name: 'Tricep Extensions', sets: 3, reps: 15, rest: '60s', hasWeight: true, defaultWeight: 25 },
                    { name: 'Med Ball Twists', sets: 3, reps: 20, rest: '45s', hasWeight: true, defaultWeight: 15 },
                    { name: 'Dead Bugs', sets: 3, reps: '12/side', rest: '30s' },
                    { name: 'Stretch', sets: 1, reps: '5 min' }
                ]
            },
            wednesday: { 
                name: 'HIIT Conditioning', 
                duration: '60 min',
                location: 'track',
                equipmentNeeded: ['Jump rope', 'Sliders', 'Water'],
                exercises: [
                    { name: 'Warm-up Jog', sets: 1, reps: '8 min' },
                    { name: 'Sprint Intervals', sets: 8, reps: '200m @ 80%', rest: '90s' },
                    { name: 'Stadium Stairs', sets: 6, reps: 'full climb', rest: '90s' },
                    { name: 'Jump Rope HIIT', sets: 8, reps: '45s on/45s off' },
                    { name: 'Slider Mt Climbers', sets: 3, reps: 20, rest: '45s' },
                    { name: 'Burpees', sets: 3, reps: 10, rest: '60s' },
                    { name: 'High Plank Hold', sets: 3, reps: '45s', rest: '30s' },
                    { name: 'Cool-down', sets: 1, reps: '8 min' }
                ]
            },
            thursday: { 
                name: 'Full Body Power', 
                duration: '65 min',
                location: 'home',
                equipmentNeeded: ['KB: 25, 35', 'Med Ball: 15', 'Box: 20'],
                exercises: [
                    { name: 'Dynamic Warm-up', sets: 1, reps: '8 min' },
                    { name: 'Broad Jumps', sets: 4, reps: 5, rest: '2m' },
                    { name: 'KB Clean & Press', sets: 4, reps: '8/side', rest: '2m', hasWeight: true, defaultWeight: 35 },
                    { name: 'Single-Leg RDL', sets: 3, reps: '12/side', rest: '75s', hasWeight: true, defaultWeight: 25 },
                    { name: 'Box Jumps', sets: 4, reps: 8, rest: '90s', hasWeight: true, defaultWeight: 20 },
                    { name: 'KB Swings', sets: 4, reps: 25, rest: '90s', hasWeight: true, defaultWeight: 35 },
                    { name: 'Lateral Bounds', sets: 3, reps: '10/side', rest: '60s' },
                    { name: 'Weighted Carries', sets: 3, reps: '50 yds', rest: '75s', hasWeight: true, defaultWeight: 35 },
                    { name: 'Med Ball Slams', sets: 3, reps: 15, rest: '45s', hasWeight: true, defaultWeight: 15 },
                    { name: 'Ball Pikes', sets: 3, reps: 10, rest: '45s' },
                    { name: 'Mobility', sets: 1, reps: '5 min' }
                ]
            },
            friday: { 
                name: 'Upper Volume', 
                duration: '65 min',
                location: 'home',
                equipmentNeeded: ['DB: 15-40', 'KB: 20', 'Med Ball: 15'],
                exercises: [
                    { name: 'Dynamic Warm-up', sets: 1, reps: '8 min' },
                    { name: 'DB Floor Press', sets: 4, reps: 12, rest: '90s', hasWeight: true, defaultWeight: 35 },
                    { name: 'Bent-Over Rows', sets: 4, reps: 15, rest: '75s', hasWeight: true, defaultWeight: 35 },
                    { name: 'Lateral Raises', sets: 3, reps: 15, rest: '60s', hasWeight: true, defaultWeight: 15 },
                    { name: 'Pike Push-ups', sets: 3, reps: 12, rest: '75s' },
                    { name: 'KB Curls', sets: 3, reps: 15, rest: '60s', hasWeight: true, defaultWeight: 20 },
                    { name: 'Skull Crushers', sets: 3, reps: 15, rest: '60s', hasWeight: true, defaultWeight: 20 },
                    { name: 'Face Pulls', sets: 3, reps: 20, rest: '60s', hasWeight: true, defaultWeight: 15 },
                    { name: 'Side Throws', sets: 3, reps: '12/side', rest: '45s', hasWeight: true, defaultWeight: 15 },
                    { name: 'Ball Rollouts', sets: 3, reps: 10, rest: '45s' },
                    { name: 'Stretch', sets: 1, reps: '5 min' }
                ]
            },
            saturday: { 
                name: 'Athletic Power', 
                duration: '70 min',
                location: 'track',
                equipmentNeeded: ['Jump rope', 'Weighted vest: 15lb', 'Water'],
                exercises: [
                    { name: 'Dynamic Warm-up', sets: 1, reps: '12 min' },
                    { name: 'Power Sprints', sets: 8, reps: '50m @ 90%', rest: '2m' },
                    { name: 'Broad Jumps', sets: 4, reps: 5, rest: '90s' },
                    { name: 'Agility T-Drill', sets: 6, reps: 1, rest: '90s' },
                    { name: 'Lateral Bounds', sets: 3, reps: '10/side', rest: '60s' },
                    { name: 'Jump Rope', sets: 5, reps: '1 min', rest: '60s' },
                    { name: 'Weighted Stairs', sets: 5, reps: 'full climb', rest: '90s', hasWeight: true, defaultWeight: 15 },
                    { name: 'High Knees', sets: 3, reps: '30s', rest: '30s' },
                    { name: 'V-ups', sets: 3, reps: 15, rest: '45s' },
                    { name: 'Bicycle Crunches', sets: 3, reps: 20, rest: '30s' },
                    { name: 'Cool-down', sets: 1, reps: '8 min' }
                ]
            },
            sunday: { 
                name: 'Active Recovery', 
                duration: '40 min',
                location: 'home',
                equipmentNeeded: ['Jump rope', 'Foam roller'],
                exercises: [
                    { name: 'Easy Jog/Peloton', sets: 1, reps: '20 min' },
                    { name: 'Jump Rope Easy', sets: 1, reps: '5 min' },
                    { name: 'Mobility Flow', sets: 1, reps: '10 min' },
                    { name: 'Foam Rolling', sets: 1, reps: '5 min' }
                ]
            }
        };

        const prepWorkouts = {
            saturday: { 
                name: 'Prep Power', 
                duration: '55 min',
                location: 'track',
                equipmentNeeded: ['Jump rope', 'Sliders', 'Water'],
                exercises: [
                    { name: 'Dynamic Warm-up', sets: 1, reps: '12 min' },
                    { name: 'Build-up Sprints', sets: 6, reps: '40m @ 75%', rest: '2m' },
                    { name: 'Broad Jumps', sets: 3, reps: 5, rest: '90s' },
                    { name: 'Agility Drills', sets: 1, reps: '8 min' },
                    { name: 'Jump Rope', sets: 5, reps: '1 min on/off' },
                    { name: 'Easy Stairs', sets: 4, reps: 'walk up/jog down', rest: '90s' },
                    { name: 'Plank', sets: 3, reps: '30s', rest: '30s' },
                    { name: 'Mobility', sets: 1, reps: '8 min' }
                ]
            },
            sunday: { 
                name: 'Prep Recovery', 
                duration: '40 min',
                location: 'home',
                equipmentNeeded: ['Jump rope', 'Foam roller'],
                exercises: [
                    { name: 'Walk/Easy Jog', sets: 1, reps: '20 min' },
                    { name: 'Jump Rope', sets: 1, reps: '8 min' },
                    { name: 'Stretching', sets: 1, reps: '8 min' },
                    { name: 'Foam Rolling', sets: 1, reps: '4 min' }
                ]
            }
        };

        function getWorkoutSchedule(week) {
            if (week === 0) return prepWorkouts;
            
            const phase = getPhase(week);
            if (phase === 1) return JSON.parse(JSON.stringify(baseWorkouts));
            
            const schedule = JSON.parse(JSON.stringify(baseWorkouts));
            const weightMultiplier = 1 + (phase - 1) * 0.15;
            
            Object.keys(schedule).forEach(day => {
                schedule[day].exercises.forEach(ex => {
                    if (ex.hasWeight && ex.defaultWeight) {
                        ex.defaultWeight = Math.round(ex.defaultWeight * weightMultiplier);
                    }
                });
            });
            
            if (phase === 2) {
                schedule.monday.exercises[3] = { name: 'Bulgarian Split Squats', sets: 4, reps: '10/side', rest: '90s', hasWeight: true, defaultWeight: Math.round(30 * weightMultiplier) };
                schedule.tuesday.exercises[1] = { name: 'Weighted Push-ups', sets: 4, reps: 10, rest: '90s', hasWeight: true, defaultWeight: Math.round(20 * weightMultiplier) };
                schedule.thursday.exercises[2] = { name: 'KB Snatches', sets: 4, reps: '8/side', rest: '2m', hasWeight: true, defaultWeight: Math.round(35 * weightMultiplier) };
                schedule.friday.exercises[1] = { name: 'Single-Arm Floor Press', sets: 4, reps: '10/side', rest: '90s', hasWeight: true, defaultWeight: Math.round(35 * weightMultiplier) };
            }
            
            if (phase === 3) {
                schedule.monday.exercises[1] = { name: 'Depth Jumps', sets: 4, reps: 5, rest: '2m', hasWeight: true, defaultWeight: 20 };
                schedule.monday.exercises[2] = { name: 'Double KB Front Squats', sets: 5, reps: 8, rest: '2m', hasWeight: true, defaultWeight: Math.round(40 * weightMultiplier) };
                schedule.tuesday.exercises[1] = { name: 'Weighted Deficit Push-ups', sets: 4, reps: 8, rest: '2m', hasWeight: true, defaultWeight: Math.round(25 * weightMultiplier) };
                schedule.thursday.exercises[2] = { name: 'Double KB Clean & Press', sets: 5, reps: 6, rest: '2m', hasWeight: true, defaultWeight: Math.round(35 * weightMultiplier) };
                schedule.thursday.exercises[4] = { name: 'Box Jumps', sets: 4, reps: 8, rest: '90s', hasWeight: true, defaultWeight: 24 };
                schedule.friday.exercises[1] = { name: 'DB Floor Press (tempo)', sets: 5, reps: 8, rest: '90s', hasWeight: true, defaultWeight: Math.round(40 * weightMultiplier) };
            }
            
            if (phase === 4) {
                schedule.monday.exercises[1] = { name: 'Box Jumps (max height)', sets: 5, reps: 4, rest: '2m', hasWeight: true, defaultWeight: 24 };
                schedule.monday.exercises[2] = { name: 'Heavy Goblet Squats', sets: 5, reps: 6, rest: '2.5m', hasWeight: true, defaultWeight: 53 };
                schedule.tuesday.exercises[1] = { name: 'Explosive Push-ups (clap)', sets: 5, reps: 6, rest: '2m' };
                schedule.thursday.exercises[1] = { name: 'Broad Jumps (max distance)', sets: 6, reps: 3, rest: '2.5m' };
                schedule.thursday.exercises[4] = { name: 'Box Jumps', sets: 4, reps: 8, rest: '90s', hasWeight: true, defaultWeight: 30 };
                schedule.friday.exercises[1] = { name: 'Heavy DB Press (floor)', sets: 5, reps: 6, rest: '2m', hasWeight: true, defaultWeight: 50 };
            }
            
            return schedule;
        }

        // Equipment constraints - UPDATED with actual equipment
        function getEquipmentType(exerciseName) {
            const name = exerciseName.toLowerCase();
            
            // Weighted vest
            if (name.includes('weighted stairs') || name.includes('weighted vest')) {
                return { type: 'vest', options: [0, 10, 15, 20, 25, 30, 35, 40] };
            }
            
            // Medicine balls
            if (name.includes('med ball') || name.includes('medicine ball') || name.includes('ball slam') || name.includes('ball twist') || name.includes('side throw')) {
                return { type: 'medball', options: [5, 10, 15, 20, 30, 40] };
            }
            
            // Box heights
            if (name.includes('box jump')) {
                return { type: 'box', options: [6, 20, 24, 30] };
            }
            
            // Kettlebells - single available at each weight
            if (name.includes('kb ') || name.includes('kettlebell') || name.includes('goblet') || name.includes('swing')) {
                return { type: 'kettlebell', options: [5, 10, 15, 20, 25, 35, 40, 44, 53, 62] };
            }
            
            // Dumbbells - two of each available
            if (name.includes('db ') || name.includes('dumbbell') || name.includes('curl') || name.includes('raise') || name.includes('skull crusher')) {
                return { type: 'dumbbell', options: [2.5, 5, 7.5, 10, 12.5, 15, 17.5, 20, 22.5, 25, 30, 35, 40, 45, 50, 52.5] };
            }
            
            return { type: 'weight', increment: 5, min: 5 };
        }

        function getClosestWeight(target, equipment) {
            if (!equipment.options) return target;
            
            // Find closest available weight
            return equipment.options.reduce((prev, curr) => 
                Math.abs(curr - target) < Math.abs(prev - target) ? curr : prev
            );
        }

        function getSmartRecommendation(exerciseName, setIndex, week) {
            const key = `${week}-${exerciseName}-${setIndex}`;
            const stored = state.exerciseWeights[key];
            
            if (stored) return stored;
            
            // Look for previous set in SAME workout session only
            if (setIndex > 0) {
                const prevKey = `${week}-${exerciseName}-${setIndex - 1}`;
                const prevWeight = state.exerciseWeights[prevKey];
                if (prevWeight) return prevWeight;
            }
            
            // Look for last week's same set
            if (week > 0) {
                const lastWeekKey = `${week - 1}-${exerciseName}-${setIndex}`;
                const lastWeek = state.exerciseWeights[lastWeekKey];
                if (lastWeek) return lastWeek;
            }
            
            // Return default
            const schedule = getWorkoutSchedule(week);
            for (const day in schedule) {
                const exercise = schedule[day].exercises.find(ex => ex.name === exerciseName);
                if (exercise && exercise.hasWeight) {
                    const equipment = getEquipmentType(exerciseName);
                    return getClosestWeight(exercise.defaultWeight, equipment);
                }
            }
            
            return 0;
        }

        function updateFutureSets(exerciseName, currentSetIndex, newWeight, week, totalSets) {
            // Only update sets AFTER the current one, never before
            for (let i = currentSetIndex + 1; i < totalSets; i++) {
                const futureKey = `${week}-${exerciseName}-${i}`;
                state.exerciseWeights[futureKey] = newWeight;
            }
            saveState();
        }

        function render() {
            const app = document.getElementById('app');
            
            if (state.view === 'overview') {
                renderOverview(app);
            } else if (state.view === 'workout') {
                renderWorkout(app);
            } else if (state.view === 'supplements') {
                renderSupplements(app);
            }
        }

        function renderOverview(app) {
            const schedule = getWorkoutSchedule(state.currentWeek);
            const phase = getPhase(state.currentWeek);
            const phaseInfo = getPhaseInfo(phase);
            const dateRange = getWeekDateRange(state.currentWeek);
            
            const days = state.currentWeek === 0 ? ['saturday', 'sunday'] : 
                ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];
            
            app.innerHTML = `
                <div class="sticky-header shadow-xl">
                    <div class="p-6">
                        <h1 class="text-3xl font-bold text-center mb-2">üí™ rba | fit</h1>
                        <div class="text-center text-slate-300 text-sm mb-4">${dateRange}</div>
                        
                        <div class="flex items-center justify-between mb-4">
                            <button onclick="changeWeek(-1)" class="px-4 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg transition-colors" ${state.currentWeek === 0 ? 'disabled' : ''}>
                                ‚Üê Week ${state.currentWeek - 1}
                            </button>
                            <div class="text-center">
                                <div class="text-2xl font-bold">Week ${state.currentWeek}</div>
                                <div class="text-sm text-blue-400">${phaseInfo.name}</div>
                                <div class="text-xs text-slate-400">${phaseInfo.focus}</div>
                            </div>
                            <button onclick="changeWeek(1)" class="px-4 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg transition-colors" ${state.currentWeek === 16 ? 'disabled' : ''}>
                                Week ${state.currentWeek + 1} ‚Üí
                            </button>
                        </div>

                        <button onclick="showSupplements()" class="w-full mt-2 px-4 py-2 bg-purple-600 hover:bg-purple-500 rounded-lg transition-colors flex items-center justify-center gap-2">
                            üíä Daily Supplements
                        </button>
                    </div>
                </div>

                <div class="p-6 space-y-4">
                    ${days.map(day => {
                        const workout = schedule[day];
                        if (!workout) return '';
                        
                        const dayKey = `${state.currentWeek}-${day}`;
                        const completedCount = (state.completedExercises[dayKey] || []).length;
                        const totalExercises = workout.exercises.length;
                        const progress = (completedCount / totalExercises) * 100;
                        
                        return `
                            <div onclick="selectDay('${day}')" class="bg-slate-800 rounded-lg p-5 hover:bg-slate-750 transition-all cursor-pointer border border-slate-700 hover:border-blue-500">
                                <div class="flex justify-between items-start mb-3">
                                    <div>
                                        <h3 class="text-xl font-bold capitalize text-blue-400">${day}</h3>
                                        <p class="text-lg text-white mt-1">${workout.name}</p>
                                        <p class="text-sm text-slate-400">${workout.duration} ‚Ä¢ ${workout.location}</p>
                                        ${workout.equipmentNeeded ? `
                                            <p class="text-xs text-slate-500 mt-1">üì¶ ${workout.equipmentNeeded.join(' ‚Ä¢ ')}</p>
                                        ` : ''}
                                    </div>
                                    <div class="text-right">
                                        <div class="text-2xl mb-1">${completedCount === totalExercises ? '‚úÖ' : 'üìã'}</div>
                                        <div class="text-sm text-slate-400">${completedCount}/${totalExercises}</div>
                                    </div>
                                </div>
                                
                                <div class="w-full bg-slate-700 rounded-full h-2">
                                    <div class="bg-blue-500 h-2 rounded-full transition-all" style="width: ${progress}%"></div>
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
        }

        function renderWorkout(app) {
            const schedule = getWorkoutSchedule(state.currentWeek);
            const workout = schedule[state.selectedDay];
            const dayKey = `${state.currentWeek}-${state.selectedDay}`;
            const completed = state.completedExercises[dayKey] || [];
            
            app.innerHTML = `
                <div class="sticky-header shadow-xl">
                    <div class="p-6">
                        <button onclick="backToOverview()" class="mb-4 px-4 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg transition-colors">
                            ‚Üê Back
                        </button>
                        <h2 class="text-2xl font-bold capitalize">${state.selectedDay}</h2>
                        <p class="text-xl text-blue-400 mt-1">${workout.name}</p>
                        <p class="text-sm text-slate-400 mt-1">${workout.duration} ‚Ä¢ ${workout.location}</p>
                        ${workout.note ? `<p class="text-xs text-yellow-400 mt-2">‚ö†Ô∏è ${workout.note}</p>` : ''}
                        ${workout.equipmentNeeded ? `
                            <p class="text-xs text-slate-400 mt-2">üì¶ Bring: ${workout.equipmentNeeded.join(', ')}</p>
                        ` : ''}
                    </div>
                </div>

                <div class="p-6 space-y-4">
                    ${workout.exercises.map((exercise, exIndex) => {
                        const isCompleted = completed.includes(exercise.name);
                        const muscles = getMuscleGroups(exercise.name);
                        
                        return `
                            <div class="bg-slate-800 rounded-lg p-5 border border-slate-700">
                                <div class="flex justify-between items-start mb-3">
                                    <div class="flex-1">
                                        <h3 class="text-lg font-bold ${isCompleted ? 'text-green-400 line-through' : 'text-white'}">
                                            ${exercise.name}
                                            ${muscles.primary.length > 0 ? muscles.primary.map(m => 
                                                `<span class="muscle-tag primary-muscle">${m}</span>`
                                            ).join('') : ''}
                                            ${muscles.secondary.length > 0 ? muscles.secondary.slice(0, 2).map(m => 
                                                `<span class="muscle-tag secondary-muscle">${m}</span>`
                                            ).join('') : ''}
                                        </h3>
                                        <p class="text-sm text-slate-400 mt-1">
                                            ${exercise.sets} sets √ó ${exercise.reps} reps
                                            ${exercise.rest ? ` ‚Ä¢ ${exercise.rest} rest` : ''}
                                        </p>
                                    </div>
                                    <button onclick="toggleExercise('${exercise.name}')" class="ml-4 text-3xl">
                                        ${isCompleted ? '‚úÖ' : '‚≠ï'}
                                    </button>
                                </div>
                                
                                ${exercise.hasWeight ? `
                                    <div class="mt-3 pt-3 border-t border-slate-700">
                                        <div class="grid grid-cols-${Math.min(exercise.sets, 4)} gap-2">
                                            ${Array.from({ length: exercise.sets }, (_, i) => {
                                                const weight = getSmartRecommendation(exercise.name, i, state.currentWeek);
                                                const equipment = getEquipmentType(exercise.name);
                                                
                                                return `
                                                    <div class="text-center">
                                                        <div class="text-xs text-slate-500 mb-1">Set ${i + 1}</div>
                                                        ${state.editingSet === `${exercise.name}-${i}` ? `
                                                            <input 
                                                                type="number" 
                                                                inputmode="decimal"
                                                                value="${state.tempWeight}"
                                                                onchange="saveWeight('${exercise.name}', ${i}, this.value, ${exercise.sets})"
                                                                onblur="cancelEdit()"
                                                                class="w-full px-2 py-1 bg-slate-700 border border-blue-500 rounded text-center text-white"
                                                                autofocus
                                                                id="weight-input-${exercise.name}-${i}"
                                                            />
                                                        ` : `
                                                            <div class="flex items-center justify-center gap-1">
                                                                <span class="text-lg font-bold text-blue-400">${weight}</span>
                                                                <button 
                                                                    onclick="startEdit('${exercise.name}', ${i}, ${weight})"
                                                                    class="text-slate-500 hover:text-blue-400 transition-colors"
                                                                >‚úèÔ∏è</button>
                                                            </div>
                                                        `}
                                                        <div class="text-xs text-slate-600">${equipment.type === 'box' ? 'in' : 'lbs'}</div>
                                                    </div>
                                                `;
                                            }).join('')}
                                        </div>
                                    </div>
                                ` : ''}
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
        }

        function renderSupplements(app) {
            const today = new Date().toISOString().split('T')[0];
            const dayLog = state.supplementLog[today] || {};
            
            app.innerHTML = `
                <div class="sticky-header shadow-xl">
                    <div class="p-6">
                        <button onclick="backToOverview()" class="mb-4 px-4 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg transition-colors">
                            ‚Üê Back
                        </button>
                        <h2 class="text-2xl font-bold">üíä Daily Supplements</h2>
                        <p class="text-sm text-slate-400 mt-1">${new Date().toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric' })}</p>
                    </div>
                </div>

                <div class="p-6 space-y-6">
                    ${Object.entries(supplementSchedule).map(([timeKey, timeData]) => {
                        // Filter supplements based on conditional checks
                        let supplements = timeData.supplements;
                        
                        // Special handling for pre-workout beta-alanine (only on workout days - not Sunday)
                        if (timeKey === 'preworkout') {
                            const dayOfWeek = new Date().getDay();
                            if (dayOfWeek === 0) { // Sunday
                                supplements = [];
                            }
                        }
                        
                        // Filter out conditional supplements if their check function returns false
                        supplements = supplements.filter(supp => {
                            if (supp.conditional && supp.checkFunction) {
                                return supp.checkFunction();
                            }
                            return true;
                        });
                        
                        // Skip entire time block if no supplements
                        if (supplements.length === 0) return '';
                        
                        return `
                            <div class="bg-slate-800 rounded-lg p-5 border border-slate-700">
                                <div class="flex justify-between items-center mb-4">
                                    <div>
                                        <h3 class="text-xl font-bold text-purple-400">${timeData.time}</h3>
                                        <p class="text-sm text-slate-400">${timeData.note}</p>
                                    </div>
                                </div>
                                
                                <div class="space-y-3">
                                    ${supplements.map(supp => {
                                        const suppKey = `${timeKey}-${supp.name}`;
                                        const taken = dayLog[suppKey] || false;
                                        
                                        return `
                                            <div class="flex items-center justify-between p-3 bg-slate-900 rounded-lg">
                                                <div class="flex items-center gap-3">
                                                    <span class="text-2xl">${supp.icon}</span>
                                                    <div>
                                                        <p class="font-semibold ${taken ? 'text-green-400 line-through' : 'text-white'}">${supp.name}</p>
                                                        <p class="text-xs text-slate-400">${supp.dose}</p>
                                                    </div>
                                                </div>
                                                <button 
                                                    onclick="toggleSupplement('${timeKey}', '${supp.name}')"
                                                    class="text-3xl"
                                                >
                                                    ${taken ? '‚úÖ' : '‚≠ï'}
                                                </button>
                                            </div>
                                        `;
                                    }).join('')}
                                </div>
                            </div>
                        `;
                    }).join('')}
                    
                    <div class="bg-blue-900 bg-opacity-30 rounded-lg p-4 border border-blue-700">
                        <p class="text-sm text-blue-300">
                            <strong>üí° Tip:</strong> Beta-Alanine is only on workout days (Mon-Sat). Collagen alternates every other day at 3 PM.
                        </p>
                    </div>
                </div>
            `;
        }

        function changeWeek(delta) {
            const newWeek = state.currentWeek + delta;
            if (newWeek >= 0 && newWeek <= 16) {
                state.currentWeek = newWeek;
                saveState();
                render();
            }
        }

        function selectDay(day) {
            state.selectedDay = day;
            state.view = 'workout';
            render();
        }

        function backToOverview() {
            state.view = 'overview';
            state.editingSet = null;
            render();
        }

        function showSupplements() {
            state.view = 'supplements';
            render();
        }

        function toggleExercise(exerciseName) {
            const dayKey = `${state.currentWeek}-${state.selectedDay}`;
            if (!state.completedExercises[dayKey]) {
                state.completedExercises[dayKey] = [];
            }
            
            const index = state.completedExercises[dayKey].indexOf(exerciseName);
            if (index > -1) {
                state.completedExercises[dayKey].splice(index, 1);
            } else {
                state.completedExercises[dayKey].push(exerciseName);
            }
            
            saveState();
            render();
        }

        function toggleSupplement(timeKey, suppName) {
            const today = new Date().toISOString().split('T')[0];
            if (!state.supplementLog[today]) {
                state.supplementLog[today] = {};
            }
            
            const suppKey = `${timeKey}-${suppName}`;
            state.supplementLog[today][suppKey] = !state.supplementLog[today][suppKey];
            
            saveState();
            render();
        }

        function startEdit(exerciseName, setIndex, currentWeight) {
            state.editingSet = `${exerciseName}-${setIndex}`;
            state.tempWeight = currentWeight.toString();
            render();
            
            // Focus and select all text, with cursor at the end
            setTimeout(() => {
                const input = document.getElementById(`weight-input-${exerciseName}-${setIndex}`);
                if (input) {
                    input.focus();
                    // Set cursor to the end
                    const length = input.value.length;
                    input.setSelectionRange(length, length);
                }
            }, 100);
        }

        function saveWeight(exerciseName, setIndex, value, totalSets) {
            const newWeight = parseFloat(value);
            if (!isNaN(newWeight) && newWeight > 0) {
                const key = `${state.currentWeek}-${exerciseName}-${setIndex}`;
                state.exerciseWeights[key] = newWeight;
                
                // Update all future sets (not past sets)
                updateFutureSets(exerciseName, setIndex, newWeight, state.currentWeek, totalSets);
                
                saveState();
            }
            
            state.editingSet = null;
            state.tempWeight = '';
            render();
        }

        function cancelEdit() {
            setTimeout(() => {
                if (state.editingSet) {
                    state.editingSet = null;
                    state.tempWeight = '';
                    render();
                }
            }, 200);
        }

        // Initialize
        render();
    </script>
</body>
</html>

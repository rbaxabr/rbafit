<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Â« rba | fit Â»</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#1e293b">
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='0.9em' font-size='90'%3EðŸ’ª%3C/text%3E%3C/svg%3E">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .sticky-header {
            position: sticky;
            top: 0;
            z-index: 50;
            background: linear-gradient(to bottom right, rgb(15, 23, 42), rgb(30, 41, 59));
        }
        .muscle-tag {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.7rem;
            margin-left: 4px;
            opacity: 0.8;
        }
        .primary-muscle {
            background-color: rgba(59, 130, 246, 0.3);
            border: 1px solid rgba(59, 130, 246, 0.5);
        }
        .secondary-muscle {
            background-color: rgba(156, 163, 175, 0.2);
            border: 1px solid rgba(156, 163, 175, 0.3);
        }
        .gradient-text {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        /* Smooth transitions */
        button {
            transition: all 0.2s ease;
        }
        button:active {
            transform: scale(0.95);
        }
        .workout-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .workout-card:active {
            transform: scale(0.98);
        }
        .progress-bar {
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }
        input:focus {
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.3);
        }
        html {
            scroll-behavior: smooth;
        }
        /* Progress Rings - Apple Watch Style */
        .progress-ring {
            position: relative;
            width: 110px;
            height: 110px;
        }
        .progress-ring-circle {
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
        }
        .progress-ring-bg {
            fill: none;
            stroke: rgba(71, 85, 105, 0.3);
        }
        .progress-ring-fill {
            fill: none;
            stroke-linecap: round;
            transition: stroke-dashoffset 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .ring-program { stroke: url(#gradient-program); }
        .ring-week { stroke: url(#gradient-week); }
        .ring-supplement { stroke: url(#gradient-supplement); }
        .progress-ring-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-900 to-slate-800 text-white min-h-screen">
    <div id="app"></div>

    <script>
        function getCurrentWeek() {
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            const week0Start = new Date(2025, 9, 11);
            const week1Start = new Date(2025, 9, 13);
            
            week0Start.setHours(0, 0, 0, 0);
            week1Start.setHours(0, 0, 0, 0);
            
            if (today < week0Start) return 0;
            if (today >= week0Start && today < week1Start) return 0;
            
            const diffTime = today - week1Start;
            const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
            const weekNum = Math.floor(diffDays / 7) + 1;
            
            return Math.max(1, Math.min(16, weekNum));
        }

        const state = {
            currentWeek: parseInt(localStorage.getItem('lastWeek')) || getCurrentWeek(),
            selectedDay: null,
            view: 'overview',
            completedExercises: JSON.parse(localStorage.getItem('workoutProgress') || '{}'),
            exerciseWeights: JSON.parse(localStorage.getItem('exerciseWeights') || '{}'),
            supplementLog: JSON.parse(localStorage.getItem('supplementLog') || '{}'),
            editingSet: null,
            tempWeight: ''
        };

        function saveState() {
            localStorage.setItem('workoutProgress', JSON.stringify(state.completedExercises));
            localStorage.setItem('exerciseWeights', JSON.stringify(state.exerciseWeights));
            localStorage.setItem('supplementLog', JSON.stringify(state.supplementLog));
            localStorage.setItem('lastWeek', state.currentWeek.toString());
        }

        function getWeekDates(week) {
            if (week === 0) {
                return {
                    saturday: new Date(2025, 9, 11),
                    sunday: new Date(2025, 9, 12)
                };
            }
            
            const week1Monday = new Date(2025, 9, 13);
            const daysFromWeek1 = (week - 1) * 7;
            
            const monday = new Date(week1Monday);
            monday.setDate(week1Monday.getDate() + daysFromWeek1);
            
            return {
                monday: new Date(monday),
                tuesday: new Date(monday.getTime() + 86400000),
                wednesday: new Date(monday.getTime() + 172800000),
                thursday: new Date(monday.getTime() + 259200000),
                friday: new Date(monday.getTime() + 345600000),
                saturday: new Date(monday.getTime() + 432000000),
                sunday: new Date(monday.getTime() + 518400000)
            };
        }

        function formatDate(date) {
            return date.toLocaleDateString('en-GB', { day: 'numeric', month: 'short' });
        }

        function getWeekDateRange(week) {
            const dates = getWeekDates(week);
            if (week === 0) {
                return `${formatDate(dates.saturday)} - ${formatDate(dates.sunday)}`;
            }
            return `${formatDate(dates.monday)} - ${formatDate(dates.sunday)}`;
        }

        function getDayDate(week, day) {
            const dates = getWeekDates(week);
            return dates[day] ? formatDate(dates[day]) : '';
        }

        function shouldTakeCollagenToday() {
            const today = new Date();
            const startDate = new Date(2025, 9, 11);
            const daysSinceStart = Math.floor((today - startDate) / (1000 * 60 * 60 * 24));
            return daysSinceStart % 2 === 0;
        }

        const supplementSchedule = {
            preworkout: {
                time: '6:00 AM',
                note: 'Before training',
                supplements: [
                    { name: 'Beta-Alanine', dose: '3.2g (4 caps)', icon: 'âš¡', conditional: true }
                ]
            },
            morning: {
                time: '8:30 AM',
                note: 'Post-workout',
                supplements: [
                    { name: 'Whey Protein', dose: '2 scoops (50g)', icon: 'ðŸ¥¤' },
                    { name: 'Creatine', dose: '5g', icon: 'ðŸ’ª' },
                    { name: 'Omega-3', dose: '1 cap', icon: 'ðŸŸ' },
                    { name: 'Vitamin D3+K2', dose: '4000IU+100mcg', icon: 'â˜€ï¸' },
                    { name: 'B-Complex', dose: '1 cap', icon: 'ðŸ”‹' },
                    { name: 'Vitamin C', dose: '500mg', icon: 'ðŸŠ' }
                ]
            },
            afternoon: {
                time: '3:00 PM',
                note: 'Mid-day (every other day)',
                supplements: [
                    { name: 'Collagen', dose: '1 scoop', icon: 'ðŸ¦´', conditional: true, checkFunction: shouldTakeCollagenToday }
                ]
            },
            evening: {
                time: '9:30 PM',
                note: 'Before bed',
                supplements: [
                    { name: 'Magnesium', dose: '240mg', icon: 'ðŸ˜´' },
                    { name: 'Zinc', dose: '30mg', icon: 'ðŸ›¡ï¸' },
                    { name: 'Ashwagandha', dose: '500mg', icon: 'ðŸ§˜' }
                ]
            }
        };

        const muscleMappings = {
            'Box Jumps': { primary: ['Quads'], secondary: ['Glutes', 'Calves'] },
            'Goblet Squats': { primary: ['Quads', 'Glutes'], secondary: ['Core'] },
            'Single-Leg Step-ups': { primary: ['Quads', 'Glutes'], secondary: ['Balance'] },
            'KB Swings': { primary: ['Glutes', 'Hamstrings'], secondary: ['Core', 'Shoulders'] },
            'KB Swings (heavy)': { primary: ['Glutes', 'Hamstrings'], secondary: ['Core', 'Shoulders'] },
            'Walking Lunges': { primary: ['Quads', 'Glutes'], secondary: ['Balance'] },
            'Slider Leg Curls': { primary: ['Hamstrings'], secondary: ['Glutes'] },
            'Bulgarian Split Squats': { primary: ['Quads', 'Glutes'], secondary: ['Balance'] },
            'Single-Leg RDL': { primary: ['Hamstrings', 'Glutes'], secondary: ['Core'] },
            'DB Front Squats': { primary: ['Quads', 'Glutes'], secondary: ['Core'] },
            'Heavy Goblet Squats': { primary: ['Quads', 'Glutes'], secondary: ['Core'] },
            'Goblet Squat Pulses': { primary: ['Quads', 'Glutes'], secondary: ['Core'] },
            'Depth Jumps': { primary: ['Power', 'Quads'], secondary: [] },
            
            'DB Floor Press': { primary: ['Chest'], secondary: ['Triceps', 'Shoulders'] },
            'DB Bench Press (tempo 3-0-1)': { primary: ['Chest'], secondary: ['Triceps', 'Shoulders'] },
            'Heavy DB Bench Press': { primary: ['Chest'], secondary: ['Triceps', 'Shoulders'] },
            'DB Floor Press (wide grip)': { primary: ['Chest'], secondary: ['Triceps'] },
            'Heavy DB Floor Press': { primary: ['Chest'], secondary: ['Triceps'] },
            'Incline DB Press': { primary: ['Upper Chest', 'Shoulders'], secondary: ['Triceps'] },
            'Chest Flyes': { primary: ['Chest'], secondary: [] },
            'DB Chest Flyes': { primary: ['Chest'], secondary: [] },
            
            'KB Rows': { primary: ['Back'], secondary: ['Biceps'] },
            'DB Rows': { primary: ['Back'], secondary: ['Biceps'] },
            'DB Rows (tempo 3-0-1)': { primary: ['Back'], secondary: ['Biceps'] },
            'Heavy DB Rows': { primary: ['Back'], secondary: ['Biceps'] },
            'DB Rows (heavy)': { primary: ['Back'], secondary: ['Biceps'] },
            'Single-Arm KB Rows': { primary: ['Back'], secondary: ['Biceps', 'Core'] },
            'Bent-Over Rows': { primary: ['Back'], secondary: ['Biceps'] },
            
            'KB Shoulder Press': { primary: ['Shoulders'], secondary: ['Triceps'] },
            'DB Shoulder Press': { primary: ['Shoulders'], secondary: ['Triceps'] },
            'Arnold Press': { primary: ['Shoulders'], secondary: ['Triceps'] },
            'Push-ups': { primary: ['Chest'], secondary: ['Triceps', 'Core'] },
            'Push-ups (feet elevated)': { primary: ['Upper Chest'], secondary: ['Triceps', 'Core'] },
            'Explosive Push-ups (clap)': { primary: ['Chest', 'Power'], secondary: ['Triceps'] },
            'Weighted Push-ups': { primary: ['Chest'], secondary: ['Triceps', 'Core'] },
            'Weighted Deficit Push-ups': { primary: ['Chest'], secondary: ['Triceps'] },
            
            'Lateral Raises': { primary: ['Shoulders'], secondary: [] },
            'Lateral Raises (drop set)': { primary: ['Shoulders'], secondary: [] },
            'Lateral Raise Giant Set': { primary: ['Shoulders'], secondary: [] },
            'Rear Delt Flyes': { primary: ['Rear Delts'], secondary: ['Upper Back'] },
            'Face Pulls': { primary: ['Rear Delts'], secondary: ['Traps'] },
            'Pike Push-ups': { primary: ['Shoulders'], secondary: ['Triceps'] },
            'KB Upright Rows': { primary: ['Shoulders'], secondary: ['Traps'] },
            
            'Hammer Curls': { primary: ['Biceps'], secondary: ['Forearms'] },
            'DB Bicep Curls': { primary: ['Biceps'], secondary: [] },
            'Bicep Curls': { primary: ['Biceps'], secondary: [] },
            'Bicep Curl Superset': { primary: ['Biceps'], secondary: [] },
            'Concentration Curls': { primary: ['Biceps'], secondary: [] },
            'KB Curls': { primary: ['Biceps'], secondary: [] },
            
            'Tricep Extensions': { primary: ['Triceps'], secondary: [] },
            'Overhead Tricep Extension': { primary: ['Triceps'], secondary: [] },
            'Tricep Extension Superset': { primary: ['Triceps'], secondary: [] },
            'Tricep Kickbacks': { primary: ['Triceps'], secondary: [] },
            'Tricep Dips': { primary: ['Triceps'], secondary: ['Chest'] },
            'Skull Crushers': { primary: ['Triceps'], secondary: [] },
            
            'KB Clean & Press': { primary: ['Full Body'], secondary: ['Power'] },
            'DB Clean & Press': { primary: ['Full Body'], secondary: ['Power'] },
            'Heavy DB Clean & Press': { primary: ['Full Body'], secondary: ['Power'] },
            'Broad Jumps': { primary: ['Power', 'Legs'], secondary: [] },
            'Broad Jumps (max distance)': { primary: ['Power', 'Legs'], secondary: [] },
            'Weighted Carries': { primary: ['Core', 'Grip'], secondary: ['Traps'] },
            'Heavy Carries': { primary: ['Core', 'Grip'], secondary: ['Traps'] },
            'KB Snatches': { primary: ['Full Body'], secondary: ['Power'] },
            'Single-Arm Floor Press': { primary: ['Chest'], secondary: ['Triceps', 'Core'] },
            'DB Floor Press (tempo)': { primary: ['Chest'], secondary: ['Triceps'] },
            
            'Sprint Intervals': { primary: ['Cardio', 'Legs'], secondary: [] },
            'Stadium Stairs': { primary: ['Cardio', 'Quads'], secondary: ['Glutes'] },
            'Jump Rope HIIT': { primary: ['Cardio'], secondary: ['Calves'] },
            'Slider Mt Climbers': { primary: ['Core'], secondary: ['Shoulders'] },
            'Power Sprints': { primary: ['Speed', 'Legs'], secondary: [] },
            'Agility T-Drill': { primary: ['Agility'], secondary: ['Legs'] },
            'Lateral Bounds': { primary: ['Lateral Power'], secondary: ['Legs'] },
            'Jump Rope': { primary: ['Cardio'], secondary: ['Calves'] },
            'Weighted Stairs': { primary: ['Cardio', 'Quads'], secondary: ['Glutes'] },
            
            'Med Ball Slams': { primary: ['Core', 'Power'], secondary: ['Shoulders'] },
            'Plank Hold': { primary: ['Core'], secondary: [] },
            'Weighted Plank': { primary: ['Core'], secondary: [] },
            'Med Ball Twists': { primary: ['Obliques'], secondary: ['Core'] },
            'Dead Bugs': { primary: ['Core'], secondary: [] },
            'Burpees': { primary: ['Full Body'], secondary: ['Cardio'] },
            'High Plank Hold': { primary: ['Core'], secondary: ['Shoulders'] },
            'Ball Pikes': { primary: ['Core'], secondary: ['Shoulders'] },
            'Side Throws': { primary: ['Obliques'], secondary: ['Core'] },
            'Ball Rollouts': { primary: ['Core'], secondary: [] },
            'High Knees': { primary: ['Cardio'], secondary: ['Hip Flexors'] },
            'V-ups': { primary: ['Core'], secondary: [] },
            'Bicycle Crunches': { primary: ['Abs', 'Obliques'], secondary: [] },
            'Finisher: Ladder Sprint + Burpees': { primary: ['Cardio', 'Full Body'], secondary: [] },
            'Finisher: Ball Slams Circuit': { primary: ['Cardio', 'Core'], secondary: ['Shoulders'] }
        };

        function getMuscleGroups(exerciseName) {
            return muscleMappings[exerciseName] || { primary: [], secondary: [] };
        }

        function getPhase(week) {
            if (week === 0) return 0;
            if (week <= 4) return 1;
            if (week <= 8) return 2;
            if (week <= 12) return 3;
            return 4;
        }

        function getPhaseInfo(phase) {
            const phases = {
                0: { name: 'Prep Week', focus: 'Movement prep' },
                1: { name: 'Foundation', focus: 'Work capacity' },
                2: { name: 'Strength Building', focus: 'Progressive overload' },
                3: { name: 'Power & Hypertrophy', focus: 'Peak building' },
                4: { name: 'Peak Performance', focus: 'Max strength' }
            };
            return phases[phase];
        }

        const baseWorkouts = {
            monday: { 
                name: 'Lower Body', 
                duration: '65 min',
                location: 'home',
                exercises: [
                    { name: 'Dynamic Warm-up', sets: 1, reps: '8 min' },
                    { name: 'Box Jumps', sets: 3, reps: 8, rest: '90s', hasWeight: true, defaultWeight: 20 },
                    { name: 'Goblet Squats', sets: 4, reps: 15, rest: '90s', hasWeight: true, defaultWeight: 35 },
                    { name: 'Single-Leg Step-ups', sets: 3, reps: '12 each leg', rest: '75s', hasWeight: true, defaultWeight: 20 },
                    { name: 'KB Swings', sets: 4, reps: 20, rest: '75s', hasWeight: true, defaultWeight: 35 },
                    { name: 'Walking Lunges', sets: 3, reps: '20 steps', rest: '75s', hasWeight: true, defaultWeight: 20 },
                    { name: 'Slider Leg Curls', sets: 3, reps: 12, rest: '60s' },
                    { name: 'Med Ball Slams', sets: 3, reps: 15, rest: '45s', hasWeight: true, defaultWeight: 15 },
                    { name: 'Plank Hold', sets: 3, reps: '45s', rest: '30s' },
                    { name: 'Mobility Cool-down', sets: 1, reps: '5 min' }
                ]
            },
            tuesday: { 
                name: 'Upper Body', 
                duration: '70 min',
                location: 'home',
                exercises: [
                    { name: 'Dynamic Warm-up', sets: 1, reps: '8 min' },
                    { name: 'DB Floor Press', sets: 4, reps: 12, rest: '90s', hasWeight: true, defaultWeight: 35 },
                    { name: 'KB Rows', sets: 4, reps: '15 each arm', rest: '90s', hasWeight: true, defaultWeight: 35 },
                    { name: 'KB Shoulder Press', sets: 4, reps: 12, rest: '75s', hasWeight: true, defaultWeight: 25 },
                    { name: 'Push-ups', sets: 3, reps: 15, rest: '75s' },
                    { name: 'KB Upright Rows', sets: 3, reps: 15, rest: '60s', hasWeight: true, defaultWeight: 25 },
                    { name: 'Hammer Curls', sets: 3, reps: 15, rest: '60s', hasWeight: true, defaultWeight: 20 },
                    { name: 'Tricep Extensions', sets: 3, reps: 15, rest: '60s', hasWeight: true, defaultWeight: 25 },
                    { name: 'Med Ball Twists', sets: 3, reps: 20, rest: '45s', hasWeight: true, defaultWeight: 15 },
                    { name: 'Dead Bugs', sets: 3, reps: '12 each side', rest: '30s' },
                    { name: 'Stretch', sets: 1, reps: '5 min' }
                ]
            },
            wednesday: { 
                name: 'HIIT Conditioning', 
                duration: '60 min',
                location: 'stadium',
                equipmentNeeded: ['Jump rope', 'Sliders', 'Water'],
                exercises: [
                    { name: 'Warm-up Jog', sets: 1, reps: '8 min' },
                    { name: 'Sprint Intervals', sets: 8, reps: '200m @ 80%', rest: '90s' },
                    { name: 'Stadium Stairs', sets: 6, reps: 'full climb', rest: '90s' },
                    { name: 'Jump Rope HIIT', sets: 8, reps: '45s on/45s off' },
                    { name: 'Slider Mt Climbers', sets: 3, reps: 20, rest: '45s' },
                    { name: 'Burpees', sets: 3, reps: 10, rest: '60s' },
                    { name: 'High Plank Hold', sets: 3, reps: '45s', rest: '30s' },
                    { name: 'Cool-down', sets: 1, reps: '8 min' }
                ]
            },
            thursday: { 
                name: 'Full Body Power', 
                duration: '65 min',
                location: 'home',
                exercises: [
                    { name: 'Dynamic Warm-up', sets: 1, reps: '8 min' },
                    { name: 'Broad Jumps', sets: 4, reps: 5, rest: '2m' },
                    { name: 'KB Clean & Press', sets: 4, reps: '8 each arm', rest: '2m', hasWeight: true, defaultWeight: 35 },
                    { name: 'Single-Leg RDL', sets: 3, reps: '12 each leg', rest: '75s', hasWeight: true, defaultWeight: 25 },
                    { name: 'Box Jumps', sets: 4, reps: 8, rest: '90s', hasWeight: true, defaultWeight: 20 },
                    { name: 'KB Swings', sets: 4, reps: 25, rest: '90s', hasWeight: true, defaultWeight: 35 },
                    { name: 'Lateral Bounds', sets: 3, reps: '10 each side', rest: '60s' },
                    { name: 'Weighted Carries', sets: 3, reps: '150 steps', rest: '75s', hasWeight: true, defaultWeight: 35 },
                    { name: 'Med Ball Slams', sets: 3, reps: 15, rest: '45s', hasWeight: true, defaultWeight: 15 },
                    { name: 'Ball Pikes', sets: 3, reps: 10, rest: '45s' },
                    { name: 'Mobility', sets: 1, reps: '5 min' }
                ]
            },
            friday: { 
                name: 'Upper Volume', 
                duration: '65 min',
                location: 'home',
                exercises: [
                    { name: 'Dynamic Warm-up', sets: 1, reps: '8 min' },
                    { name: 'DB Floor Press', sets: 4, reps: 12, rest: '90s', hasWeight: true, defaultWeight: 35 },
                    { name: 'Bent-Over Rows', sets: 4, reps: 15, rest: '75s', hasWeight: true, defaultWeight: 35 },
                    { name: 'Lateral Raises', sets: 3, reps: 15, rest: '60s', hasWeight: true, defaultWeight: 15 },
                    { name: 'Pike Push-ups', sets: 3, reps: 12, rest: '75s' },
                    { name: 'KB Curls', sets: 3, reps: 15, rest: '60s', hasWeight: true, defaultWeight: 20 },
                    { name: 'Skull Crushers', sets: 3, reps: 15, rest: '60s', hasWeight: true, defaultWeight: 20 },
                    { name: 'Face Pulls', sets: 3, reps: 20, rest: '60s', hasWeight: true, defaultWeight: 15 },
                    { name: 'Side Throws', sets: 3, reps: '12 each side', rest: '45s', hasWeight: true, defaultWeight: 15 },
                    { name: 'Ball Rollouts', sets: 3, reps: 10, rest: '45s' },
                    { name: 'Stretch', sets: 1, reps: '5 min' }
                ]
            },
            saturday: { 
                name: 'Athletic Power', 
                duration: '70 min',
                location: 'stadium',
                equipmentNeeded: ['Jump rope', 'Weighted vest', 'Water'],
                exercises: [
                    { name: 'Dynamic Warm-up', sets: 1, reps: '12 min' },
                    { name: 'Power Sprints', sets: 8, reps: '50 yds @ 90%', rest: '2m' },
                    { name: 'Broad Jumps', sets: 4, reps: 5, rest: '90s' },
                    { name: 'Agility T-Drill', sets: 6, reps: 1, rest: '90s' },
                    { name: 'Lateral Bounds', sets: 3, reps: '10 each side', rest: '60s' },
                    { name: 'Jump Rope', sets: 5, reps: '1 min', rest: '60s' },
                    { name: 'Weighted Stairs', sets: 5, reps: 'full climb', rest: '90s', hasWeight: true, defaultWeight: 15 },
                    { name: 'High Knees', sets: 3, reps: '30s', rest: '30s' },
                    { name: 'V-ups', sets: 3, reps: 15, rest: '45s' },
                    { name: 'Bicycle Crunches', sets: 3, reps: 20, rest: '30s' },
                    { name: 'Cool-down', sets: 1, reps: '8 min' }
                ]
            },
            sunday: { 
                name: 'Active Recovery', 
                duration: '30 min',
                location: 'neighborhood',
                exercises: [
                    { name: 'Easy Walk', sets: 1, reps: '20 min' },
                    { name: 'Mobility Flow', sets: 1, reps: '5 min' },
                    { name: 'Foam Rolling', sets: 1, reps: '5 min' }
                ]
            }
        };

        const prepWorkouts = {
            saturday: { 
                name: 'Prep Power', 
                duration: '55 min',
                location: 'stadium',
                equipmentNeeded: ['Jump rope', 'Sliders', 'Water'],
                exercises: [
                    { name: 'Dynamic Warm-up', sets: 1, reps: '12 min' },
                    { name: 'Build-up Sprints', sets: 6, reps: '40 yds @ 75%', rest: '2m' },
                    { name: 'Broad Jumps', sets: 3, reps: 5, rest: '90s' },
                    { name: 'Agility Drills', sets: 1, reps: '8 min' },
                    { name: 'Jump Rope', sets: 5, reps: '1 min on/off' },
                    { name: 'Easy Stairs', sets: 4, reps: 'walk up/jog down', rest: '90s' },
                    { name: 'Plank', sets: 3, reps: '30s', rest: '30s' },
                    { name: 'Mobility', sets: 1, reps: '8 min' }
                ]
            },
            sunday: { 
                name: 'Prep Recovery', 
                duration: '30 min',
                location: 'neighborhood',
                exercises: [
                    { name: 'Easy Walk', sets: 1, reps: '20 min' },
                    { name: 'Stretching', sets: 1, reps: '5 min' },
                    { name: 'Foam Rolling', sets: 1, reps: '5 min' }
                ]
            }
        };

        function getWorkoutSchedule(week) {
            if (week === 0) return prepWorkouts;
            
            const phase = getPhase(week);
            if (phase === 1) return JSON.parse(JSON.stringify(baseWorkouts));
            
            const schedule = JSON.parse(JSON.stringify(baseWorkouts));
            const weightMultiplier = 1 + (phase - 1) * 0.15;
            
            Object.keys(schedule).forEach(day => {
                schedule[day].exercises.forEach(ex => {
                    if (ex.hasWeight && ex.defaultWeight) {
                        ex.defaultWeight = Math.round(ex.defaultWeight * weightMultiplier);
                    }
                });
            });
            
            if (phase === 2) {
                // PHASE 2: STRENGTH BUILDING (Weeks 5-8)
                // Goal: Build strength foundation for hypertrophy phase
                // Rep range: 8-12, Rest: 75-90s
                
                // MONDAY - Lower stays similar but add intensity
                schedule.monday.exercises[2].sets = 4;
                schedule.monday.exercises[2].reps = 12;
                schedule.monday.exercises[3] = { name: 'Bulgarian Split Squats', sets: 4, reps: '10 each leg', rest: '90s', hasWeight: true, defaultWeight: 25 };
                schedule.monday.exercises[4].sets = 4;
                schedule.monday.exercises[4].reps = 22;
                
                // TUESDAY - More upper volume, add rear delts & arms
                schedule.tuesday.exercises = [
                    { name: 'Dynamic Warm-up', sets: 1, reps: '8 min' },
                    { name: 'DB Floor Press', sets: 4, reps: 10, rest: '90s', hasWeight: true, defaultWeight: 40 },
                    { name: 'KB Rows', sets: 4, reps: '12 each arm', rest: '90s', hasWeight: true, defaultWeight: 40 },
                    { name: 'DB Shoulder Press', sets: 4, reps: 10, rest: '75s', hasWeight: true, defaultWeight: 25 },
                    { name: 'Push-ups', sets: 3, reps: 18, rest: '60s' },
                    { name: 'Rear Delt Flyes', sets: 3, reps: 12, rest: '60s', hasWeight: true, defaultWeight: 15 },
                    { name: 'DB Bicep Curls', sets: 3, reps: 12, rest: '60s', hasWeight: true, defaultWeight: 20 },
                    { name: 'Overhead Tricep Extension', sets: 3, reps: 12, rest: '60s', hasWeight: true, defaultWeight: 25 },
                    { name: 'Med Ball Twists', sets: 3, reps: 25, rest: '45s', hasWeight: true, defaultWeight: 15 },
                    { name: 'Plank Hold', sets: 3, reps: '60s', rest: '30s' },
                    { name: 'Stretch', sets: 1, reps: '5 min' }
                ];
                
                // THURSDAY - Full body with upper emphasis
                schedule.thursday.exercises[2] = { name: 'KB Snatches', sets: 4, reps: '8 each arm', rest: '2m', hasWeight: true, defaultWeight: 35 };
                schedule.thursday.exercises[7] = { name: 'Weighted Carries', sets: 3, reps: '200 steps', rest: '75s', hasWeight: true, defaultWeight: 40 };
                
                // FRIDAY - Volume upper day
                schedule.friday.exercises = [
                    { name: 'Dynamic Warm-up', sets: 1, reps: '8 min' },
                    { name: 'Incline DB Press', sets: 4, reps: '10 each arm', rest: '90s', hasWeight: true, defaultWeight: 35 },
                    { name: 'Single-Arm KB Rows', sets: 4, reps: '12 each arm', rest: '75s', hasWeight: true, defaultWeight: 40 },
                    { name: 'Lateral Raises', sets: 4, reps: 12, rest: '60s', hasWeight: true, defaultWeight: 15 },
                    { name: 'DB Chest Flyes', sets: 3, reps: 12, rest: '75s', hasWeight: true, defaultWeight: 20 },
                    { name: 'Face Pulls', sets: 3, reps: 15, rest: '60s', hasWeight: true, defaultWeight: 15 },
                    { name: 'Hammer Curls', sets: 3, reps: 12, rest: '60s', hasWeight: true, defaultWeight: 22.5 },
                    { name: 'Tricep Dips', sets: 3, reps: 12, rest: '60s' },
                    { name: 'Side Throws', sets: 3, reps: '15 each side', rest: '45s', hasWeight: true, defaultWeight: 15 },
                    { name: 'Dead Bugs', sets: 3, reps: '15 each side', rest: '30s' },
                    { name: 'Stretch', sets: 1, reps: '5 min' }
                ];
            }
            
            if (phase === 3) {
                // PHASE 3: TRUE HYPERTROPHY (Weeks 9-12)
                // Goal: MAXIMUM MUSCLE GROWTH - visible size gains
                // Rep range: 10-15, Rest: 60-75s, Volume HIGH
                // This is where you'll see the most dramatic changes
                
                // MONDAY - Lower with more volume
                schedule.monday.exercises = [
                    { name: 'Dynamic Warm-up', sets: 1, reps: '10 min' },
                    { name: 'Box Jumps', sets: 3, reps: 8, rest: '2m', hasWeight: true, defaultWeight: 24 },
                    { name: 'DB Front Squats', sets: 5, reps: 12, rest: '90s', hasWeight: true, defaultWeight: 40 },
                    { name: 'Walking Lunges', sets: 4, reps: '24 steps', rest: '75s', hasWeight: true, defaultWeight: 25 },
                    { name: 'Bulgarian Split Squats', sets: 4, reps: '12 each leg', rest: '75s', hasWeight: true, defaultWeight: 30 },
                    { name: 'KB Swings', sets: 4, reps: 25, rest: '60s', hasWeight: true, defaultWeight: 44 },
                    { name: 'Slider Leg Curls', sets: 4, reps: 15, rest: '60s' },
                    { name: 'Goblet Squat Pulses', sets: 3, reps: 20, rest: '60s', hasWeight: true, defaultWeight: 40 },
                    { name: 'Med Ball Slams', sets: 3, reps: 20, rest: '45s', hasWeight: true, defaultWeight: 20 },
                    { name: 'Plank Hold', sets: 3, reps: '75s', rest: '30s' },
                    { name: 'Mobility Cool-down', sets: 1, reps: '5 min' }
                ];
                
                // TUESDAY - HYPERTROPHY UPPER (High Volume!)
                schedule.tuesday.exercises = [
                    { name: 'Dynamic Warm-up', sets: 1, reps: '8 min' },
                    { name: 'DB Bench Press (tempo 3-0-1)', sets: 5, reps: 12, rest: '75s', hasWeight: true, defaultWeight: 40 },
                    { name: 'Incline DB Press', sets: 4, reps: 12, rest: '75s', hasWeight: true, defaultWeight: 35 },
                    { name: 'DB Rows', sets: 5, reps: 12, rest: '75s', hasWeight: true, defaultWeight: 45 },
                    { name: 'DB Shoulder Press', sets: 4, reps: 12, rest: '75s', hasWeight: true, defaultWeight: 30 },
                    { name: 'Chest Flyes', sets: 3, reps: 15, rest: '60s', hasWeight: true, defaultWeight: 20 },
                    { name: 'Rear Delt Flyes', sets: 3, reps: 15, rest: '60s', hasWeight: true, defaultWeight: 17.5 },
                    { name: 'Lateral Raises (drop set)', sets: 3, reps: '12+8', rest: '60s', hasWeight: true, defaultWeight: 17.5 },
                    { name: 'Bicep Curl Superset', sets: 4, reps: '12+12', rest: '60s', hasWeight: true, defaultWeight: 22.5 },
                    { name: 'Tricep Extension Superset', sets: 4, reps: '12+12', rest: '60s', hasWeight: true, defaultWeight: 25 },
                    { name: 'Med Ball Twists', sets: 3, reps: 30, rest: '30s', hasWeight: true, defaultWeight: 15 },
                    { name: 'Finisher: Ladder Sprint + Burpees', sets: 1, reps: '8 min EMOM' }
                ];
                
                // WEDNESDAY - Keep HIIT for fat loss
                // No changes needed
                
                // THURSDAY - Upper emphasis full body
                schedule.thursday.exercises = [
                    { name: 'Dynamic Warm-up', sets: 1, reps: '8 min' },
                    { name: 'Broad Jumps', sets: 3, reps: 6, rest: '2m' },
                    { name: 'DB Clean & Press', sets: 5, reps: 10, rest: '90s', hasWeight: true, defaultWeight: 35 },
                    { name: 'Single-Arm KB Rows', sets: 4, reps: '15 each arm', rest: '75s', hasWeight: true, defaultWeight: 44 },
                    { name: 'DB Floor Press', sets: 4, reps: 12, rest: '75s', hasWeight: true, defaultWeight: 42.5 },
                    { name: 'Box Jumps', sets: 3, reps: 10, rest: '90s', hasWeight: true, defaultWeight: 24 },
                    { name: 'Face Pulls', sets: 4, reps: 20, rest: '60s', hasWeight: true, defaultWeight: 15 },
                    { name: 'Weighted Carries', sets: 3, reps: '200 steps', rest: '75s', hasWeight: true, defaultWeight: 44 },
                    { name: 'Med Ball Slams', sets: 3, reps: 20, rest: '45s', hasWeight: true, defaultWeight: 20 },
                    { name: 'Ball Pikes', sets: 3, reps: 15, rest: '45s' },
                    { name: 'Mobility', sets: 1, reps: '5 min' }
                ];
                
                // FRIDAY - VOLUME UPPER DAY (Arms & Shoulders Focus)
                schedule.friday.exercises = [
                    { name: 'Dynamic Warm-up', sets: 1, reps: '8 min' },
                    { name: 'DB Floor Press (wide grip)', sets: 5, reps: 12, rest: '75s', hasWeight: true, defaultWeight: 42.5 },
                    { name: 'DB Rows (tempo 3-0-1)', sets: 5, reps: 12, rest: '75s', hasWeight: true, defaultWeight: 45 },
                    { name: 'Arnold Press', sets: 4, reps: 12, rest: '75s', hasWeight: true, defaultWeight: 25 },
                    { name: 'Push-ups (feet elevated)', sets: 3, reps: 15, rest: '60s' },
                    { name: 'Lateral Raise Giant Set', sets: 3, reps: '10+10+10', rest: '90s', hasWeight: true, defaultWeight: 15 },
                    { name: 'Concentration Curls', sets: 4, reps: '15 each arm', rest: '60s', hasWeight: true, defaultWeight: 20 },
                    { name: 'Overhead Tricep Extension', sets: 4, reps: 15, rest: '60s', hasWeight: true, defaultWeight: 30 },
                    { name: 'Hammer Curls', sets: 3, reps: 15, rest: '60s', hasWeight: true, defaultWeight: 22.5 },
                    { name: 'Tricep Kickbacks', sets: 3, reps: '15 each arm', rest: '60s', hasWeight: true, defaultWeight: 15 },
                    { name: 'Side Throws', sets: 3, reps: '20 each side', rest: '30s', hasWeight: true, defaultWeight: 15 },
                    { name: 'Finisher: Ball Slams Circuit', sets: 1, reps: '10 min' }
                ];
            }
            
            if (phase === 4) {
                // PHASE 4: PEAK PERFORMANCE (Weeks 13-16)
                // Goal: Peak strength while maintaining muscle size
                // Rep range: 6-10, Rest: 2-3m for compounds, still volume for accessories
                // Keep muscle while showcasing strength gains
                
                // MONDAY - Heavy lower with power
                schedule.monday.exercises = [
                    { name: 'Dynamic Warm-up', sets: 1, reps: '10 min' },
                    { name: 'Depth Jumps', sets: 5, reps: 5, rest: '2m', hasWeight: true, defaultWeight: 24 },
                    { name: 'Heavy Goblet Squats', sets: 5, reps: 8, rest: '2.5m', hasWeight: true, defaultWeight: 53 },
                    { name: 'Bulgarian Split Squats', sets: 4, reps: '10 each leg', rest: '90s', hasWeight: true, defaultWeight: 35 },
                    { name: 'KB Swings (heavy)', sets: 5, reps: 20, rest: '90s', hasWeight: true, defaultWeight: 53 },
                    { name: 'Single-Leg RDL', sets: 4, reps: '10 each leg', rest: '75s', hasWeight: true, defaultWeight: 30 },
                    { name: 'Slider Leg Curls', sets: 4, reps: 12, rest: '60s' },
                    { name: 'Med Ball Slams', sets: 3, reps: 20, rest: '45s', hasWeight: true, defaultWeight: 20 },
                    { name: 'Weighted Plank', sets: 3, reps: '60s', rest: '30s', hasWeight: true, defaultWeight: 20 },
                    { name: 'Mobility Cool-down', sets: 1, reps: '5 min' }
                ];
                
                // TUESDAY - Heavy upper with volume accessories
                schedule.tuesday.exercises = [
                    { name: 'Dynamic Warm-up', sets: 1, reps: '8 min' },
                    { name: 'Heavy DB Bench Press', sets: 5, reps: 8, rest: '2.5m', hasWeight: true, defaultWeight: 50 },
                    { name: 'Explosive Push-ups (clap)', sets: 5, reps: 8, rest: '2m' },
                    { name: 'Heavy DB Rows', sets: 5, reps: 8, rest: '2m', hasWeight: true, defaultWeight: 50 },
                    { name: 'DB Shoulder Press', sets: 4, reps: 8, rest: '90s', hasWeight: true, defaultWeight: 35 },
                    { name: 'Incline DB Press', sets: 3, reps: 10, rest: '75s', hasWeight: true, defaultWeight: 40 },
                    { name: 'Rear Delt Flyes', sets: 3, reps: 12, rest: '60s', hasWeight: true, defaultWeight: 20 },
                    { name: 'Lateral Raises', sets: 3, reps: 12, rest: '60s', hasWeight: true, defaultWeight: 17.5 },
                    { name: 'Bicep Curls', sets: 3, reps: 12, rest: '60s', hasWeight: true, defaultWeight: 25 },
                    { name: 'Tricep Extensions', sets: 3, reps: 12, rest: '60s', hasWeight: true, defaultWeight: 30 },
                    { name: 'Med Ball Twists', sets: 3, reps: 30, rest: '30s', hasWeight: true, defaultWeight: 20 }
                ];
                
                // THURSDAY - Power emphasis
                schedule.thursday.exercises = [
                    { name: 'Dynamic Warm-up', sets: 1, reps: '10 min' },
                    { name: 'Broad Jumps (max distance)', sets: 6, reps: 4, rest: '2.5m' },
                    { name: 'Heavy DB Clean & Press', sets: 5, reps: 6, rest: '2.5m', hasWeight: true, defaultWeight: 40 },
                    { name: 'Single-Arm KB Rows', sets: 4, reps: '10 each arm', rest: '90s', hasWeight: true, defaultWeight: 53 },
                    { name: 'DB Floor Press', sets: 4, reps: 8, rest: '90s', hasWeight: true, defaultWeight: 45 },
                    { name: 'Box Jumps (max height)', sets: 4, reps: 6, rest: '2m', hasWeight: true, defaultWeight: 30 },
                    { name: 'Face Pulls', sets: 3, reps: 15, rest: '60s', hasWeight: true, defaultWeight: 15 },
                    { name: 'Heavy Carries', sets: 3, reps: '250 steps', rest: '90s', hasWeight: true, defaultWeight: 53 },
                    { name: 'Med Ball Slams', sets: 3, reps: 15, rest: '45s', hasWeight: true, defaultWeight: 20 },
                    { name: 'Ball Pikes', sets: 3, reps: 12, rest: '45s' },
                    { name: 'Mobility', sets: 1, reps: '5 min' }
                ];
                
                // FRIDAY - Strength with pump work
                schedule.friday.exercises = [
                    { name: 'Dynamic Warm-up', sets: 1, reps: '8 min' },
                    { name: 'Heavy DB Floor Press', sets: 5, reps: 8, rest: '2m', hasWeight: true, defaultWeight: 50 },
                    { name: 'DB Rows (heavy)', sets: 5, reps: 8, rest: '2m', hasWeight: true, defaultWeight: 50 },
                    { name: 'Arnold Press', sets: 4, reps: 10, rest: '90s', hasWeight: true, defaultWeight: 30 },
                    { name: 'Chest Flyes', sets: 3, reps: 12, rest: '75s', hasWeight: true, defaultWeight: 25 },
                    { name: 'Lateral Raises (drop set)', sets: 3, reps: '10+8', rest: '60s', hasWeight: true, defaultWeight: 20 },
                    { name: 'Hammer Curls', sets: 4, reps: 10, rest: '60s', hasWeight: true, defaultWeight: 25 },
                    { name: 'Overhead Tricep Extension', sets: 4, reps: 10, rest: '60s', hasWeight: true, defaultWeight: 35 },
                    { name: 'Concentration Curls', sets: 3, reps: '12 each arm', rest: '60s', hasWeight: true, defaultWeight: 22.5 },
                    { name: 'Tricep Kickbacks', sets: 3, reps: '12 each arm', rest: '60s', hasWeight: true, defaultWeight: 17.5 },
                    { name: 'Side Throws', sets: 3, reps: '15 each side', rest: '30s', hasWeight: true, defaultWeight: 20 }
                ];
            }
            
            return schedule;
        }

        function getEquipmentType(exerciseName) {
            const name = exerciseName.toLowerCase();
            
            if (name.includes('weighted stairs') || name.includes('weighted vest')) {
                return { type: 'vest', options: [0, 10, 15, 20, 25, 30, 35, 40] };
            }
            
            if (name.includes('med ball') || name.includes('medicine ball') || name.includes('ball slam') || name.includes('ball twist') || name.includes('side throw')) {
                return { type: 'medball', options: [5, 10, 15, 20, 30, 40] };
            }
            
            if (name.includes('box jump')) {
                return { type: 'box', options: [6, 20, 24, 30] };
            }
            
            if (name.includes('kb ') || name.includes('kettlebell') || name.includes('goblet') || name.includes('swing')) {
                return { type: 'kettlebell', options: [5, 10, 15, 20, 25, 35, 40, 44, 53, 62, 72, 81, 90] };
            }
            
            if (name.includes('db ') || name.includes('dumbbell') || name.includes('curl') || name.includes('raise') || name.includes('skull crusher')) {
                return { type: 'dumbbell', options: [2.5, 5, 7.5, 10, 12.5, 15, 17.5, 20, 22.5, 25, 30, 35, 40, 45, 50, 52.5, 55, 60, 65, 70, 75, 80] };
            }
            
            return { type: 'weight', increment: 5, min: 5 };
        }

        function getClosestWeight(target, equipment) {
            if (!equipment.options) return target;
            return equipment.options.reduce((prev, curr) => 
                Math.abs(curr - target) < Math.abs(prev - target) ? curr : prev
            );
        }

        function getSmartRecommendation(exerciseName, setIndex, week) {
            const key = `${week}-${exerciseName}-${setIndex}`;
            const stored = state.exerciseWeights[key];
            
            if (stored) return stored;
            
            if (setIndex > 0) {
                const prevKey = `${week}-${exerciseName}-${setIndex - 1}`;
                const prevWeight = state.exerciseWeights[prevKey];
                if (prevWeight) return prevWeight;
            }
            
            if (week > 0) {
                const lastWeekKey = `${week - 1}-${exerciseName}-${setIndex}`;
                const lastWeek = state.exerciseWeights[lastWeekKey];
                if (lastWeek) return lastWeek;
            }
            
            const schedule = getWorkoutSchedule(week);
            for (const day in schedule) {
                const exercise = schedule[day].exercises.find(ex => ex.name === exerciseName);
                if (exercise && exercise.hasWeight) {
                    const equipment = getEquipmentType(exerciseName);
                    return getClosestWeight(exercise.defaultWeight, equipment);
                }
            }
            
            return 0;
        }

        function updateFutureSets(exerciseName, currentSetIndex, newWeight, week, totalSets) {
            for (let i = currentSetIndex + 1; i < totalSets; i++) {
                const futureKey = `${week}-${exerciseName}-${i}`;
                state.exerciseWeights[futureKey] = newWeight;
            }
            saveState();
        }

        function getTotalSupplementProgress() {
            const today = new Date().toISOString().split('T')[0];
            const dayLog = state.supplementLog[today] || {};
            
            let total = 0;
            let completed = 0;
            
            const dayOfWeek = new Date().getDay();
            const includePreworkout = dayOfWeek !== 0;
            
            Object.entries(supplementSchedule).forEach(([timeKey, timeData]) => {
                if (timeKey === 'preworkout' && !includePreworkout) return;
                
                let supplements = timeData.supplements.filter(supp => {
                    if (supp.conditional && supp.checkFunction) {
                        return supp.checkFunction();
                    }
                    return true;
                });
                
                supplements.forEach(supp => {
                    total++;
                    const suppKey = `${timeKey}-${supp.name}`;
                    if (dayLog[suppKey]) completed++;
                });
            });
            
            return { completed, total, percentage: total > 0 ? Math.round((completed / total) * 100) : 0 };
        }

        function getWeekProgress() {
            const schedule = getWorkoutSchedule(state.currentWeek);
            const days = state.currentWeek === 0 ? ['saturday', 'sunday'] : 
                ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];
            
            let totalExercises = 0;
            let completedExercises = 0;
            
            days.forEach(day => {
                const workout = schedule[day];
                if (workout) {
                    const dayKey = `${state.currentWeek}-${day}`;
                    const completed = state.completedExercises[dayKey] || [];
                    
                    // Validate: only count exercises that actually exist in this workout
                    const validExercises = workout.exercises.map(ex => ex.name);
                    const validCompleted = completed.filter(name => validExercises.includes(name));
                    
                    totalExercises += workout.exercises.length;
                    completedExercises += validCompleted.length;
                    
                    // Clean up invalid completions
                    if (validCompleted.length !== completed.length) {
                        state.completedExercises[dayKey] = validCompleted;
                        saveState();
                    }
                }
            });
            
            return {
                completed: completedExercises,
                total: totalExercises,
                percentage: totalExercises > 0 ? Math.round((completedExercises / totalExercises) * 100) : 0
            };
        }

        function getProgramProgress() {
            let totalExercises = 0;
            let completedExercises = 0;
            
            for (let week = 0; week <= 16; week++) {
                const schedule = getWorkoutSchedule(week);
                const days = week === 0 ? ['saturday', 'sunday'] : 
                    ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];
                
                days.forEach(day => {
                    const workout = schedule[day];
                    if (workout) {
                        const dayKey = `${week}-${day}`;
                        const completed = state.completedExercises[dayKey] || [];
                        totalExercises += workout.exercises.length;
                        completedExercises += completed.length;
                    }
                });
            }
            
            return {
                completed: completedExercises,
                total: totalExercises,
                percentage: totalExercises > 0 ? Math.round((completedExercises / totalExercises) * 100) : 0
            };
        }

        function renderProgressRing(percentage, label, colorClass, isClickable) {
            const radius = 45;
            const stroke = 7;
            const normalizedRadius = radius - stroke / 2;
            const circumference = normalizedRadius * 2 * Math.PI;
            const strokeDashoffset = circumference - (percentage / 100) * circumference;
            
            return `
                <div class="progress-ring ${isClickable ? 'hover:opacity-80 transition-opacity' : ''}">
                    <svg height="110" width="110" class="progress-ring-circle">
                        <defs>
                            <linearGradient id="gradient-program" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#a855f7;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#3b82f6;stop-opacity:1" />
                            </linearGradient>
                            <linearGradient id="gradient-week" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#3b82f6;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#06b6d4;stop-opacity:1" />
                            </linearGradient>
                            <linearGradient id="gradient-supplement" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#8b5cf6;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#ec4899;stop-opacity:1" />
                            </linearGradient>
                        </defs>
                        <circle
                            class="progress-ring-bg"
                            stroke-width="${stroke}"
                            r="${normalizedRadius}"
                            cx="55"
                            cy="55"
                        />
                        <circle
                            class="progress-ring-fill ${colorClass}"
                            stroke-width="${stroke}"
                            stroke-dasharray="${circumference} ${circumference}"
                            style="stroke-dashoffset: ${strokeDashoffset}"
                            r="${normalizedRadius}"
                            cx="55"
                            cy="55"
                        />
                    </svg>
                    <div class="progress-ring-text">
                        <div class="text-xl font-bold text-white">${percentage}%</div>
                        <div class="text-xs text-slate-400">${label}</div>
                    </div>
                </div>
            `;
        }

        function updateRingProgress(ringClass, percentage, labelText) {
            const ring = document.querySelector(`.${ringClass}`);
            if (ring) {
                const radius = 45;
                const stroke = 7;
                const normalizedRadius = radius - stroke / 2;
                const circumference = normalizedRadius * 2 * Math.PI;
                const strokeDashoffset = circumference - (percentage / 100) * circumference;
                ring.style.strokeDashoffset = strokeDashoffset;
                
                const ringContainer = ring.closest('.progress-ring');
                if (ringContainer) {
                    const percentText = ringContainer.querySelector('.text-xl');
                    const label = ringContainer.querySelector('.text-xs');
                    if (percentText) percentText.textContent = `${percentage}%`;
                    if (label && labelText) label.textContent = labelText;
                }
            }
        }

        function render() {
            const app = document.getElementById('app');
            
            if (state.view === 'overview') {
                renderOverview(app);
            } else if (state.view === 'workout') {
                renderWorkout(app);
            } else if (state.view === 'supplements') {
                renderSupplements(app);
            }
        }

        function renderOverview(app) {
            const schedule = getWorkoutSchedule(state.currentWeek);
            const phase = getPhase(state.currentWeek);
            const phaseInfo = getPhaseInfo(phase);
            const dateRange = getWeekDateRange(state.currentWeek);
            const currentWeek = getCurrentWeek();
            const weekProgress = getWeekProgress();
            const programProgress = getProgramProgress();
            const suppProgress = getTotalSupplementProgress();
            
            const days = state.currentWeek === 0 ? ['saturday', 'sunday'] : 
                ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];
            
            app.innerHTML = `
                <div class="sticky-header shadow-xl">
                    <div class="p-5">
                        <h1 class="text-3xl font-bold text-center mb-2 gradient-text">Â« rba | fit Â»</h1>
                        
                        <div class="flex items-center justify-between mb-4 gap-2">
                            <button onclick="changeWeek(-1)" class="w-24 py-2 text-slate-300 hover:text-white hover:bg-slate-700/30 rounded-lg text-sm" ${state.currentWeek === 0 ? 'disabled style="opacity: 0.3"' : ''}>
                                â† Previous
                            </button>
                            <div class="text-center flex-1">
                                <div class="text-2xl font-bold">Week ${state.currentWeek}</div>
                                <div class="text-xs text-slate-400">${dateRange}</div>
                                <div class="text-xs text-blue-400">${phaseInfo.name}</div>
                            </div>
                            <button onclick="changeWeek(1)" class="w-24 py-2 text-slate-300 hover:text-white hover:bg-slate-700/30 rounded-lg text-sm" ${state.currentWeek === 16 ? 'disabled style="opacity: 0.3"' : ''}>
                                Next â†’
                            </button>
                        </div>

                        ${state.currentWeek !== currentWeek ? `
                            <button onclick="jumpToCurrentWeek()" class="w-full mb-3 px-4 py-2 text-green-400 hover:text-green-300 hover:bg-green-900/20 rounded-lg text-sm font-medium">
                                Jump to Current Week (${currentWeek})
                            </button>
                        ` : ''}

                        <div class="flex justify-around items-center mb-2">
                            ${renderProgressRing(programProgress.percentage, 'Program', 'ring-program', false)}
                            ${renderProgressRing(weekProgress.percentage, 'Week', 'ring-week', false)}
                            <div onclick="showSupplements()" class="cursor-pointer">
                                ${renderProgressRing(suppProgress.percentage, 'ðŸ’Š Daily', 'ring-supplement', true)}
                            </div>
                        </div>
                    </div>
                </div>

                <div class="p-5 space-y-4">
                    ${days.map(day => {
                        const workout = schedule[day];
                        if (!workout) return '';
                        
                        const dayKey = `${state.currentWeek}-${day}`;
                        const completedCount = (state.completedExercises[dayKey] || []).length;
                        const totalExercises = workout.exercises.length;
                        const progress = (completedCount / totalExercises) * 100;
                        const dayDate = getDayDate(state.currentWeek, day);
                        
                        return `
                            <div onclick="selectDay('${day}')" class="workout-card bg-slate-800 rounded-lg p-5 cursor-pointer border border-slate-700 hover:border-blue-500 shadow-lg hover:shadow-xl">
                                <div class="flex justify-between items-start mb-3">
                                    <div>
                                        <h3 class="text-xl font-bold capitalize text-blue-400">${day} <span class="text-sm text-slate-400 font-normal">${dayDate}</span></h3>
                                        <p class="text-lg text-white mt-1">${workout.name}</p>
                                        <p class="text-sm text-slate-400">${workout.duration} â€¢ ${workout.location}</p>
                                        ${workout.equipmentNeeded ? `
                                            <p class="text-xs text-yellow-400 mt-1">ðŸ“¦ Bring: ${workout.equipmentNeeded.join(', ')}</p>
                                        ` : ''}
                                    </div>
                                    <div class="text-right">
                                        <div class="text-xl mb-1">${completedCount === totalExercises ? 'âœ”ï¸' : 'â­•'}</div>
                                        <div class="text-sm text-slate-400">${completedCount}/${totalExercises}</div>
                                    </div>
                                </div>
                                
                                <div class="w-full bg-slate-700 rounded-full h-2">
                                    <div class="progress-bar bg-blue-500 h-2 rounded-full" style="width: ${progress}%"></div>
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
        }

        function renderWorkout(app) {
            const schedule = getWorkoutSchedule(state.currentWeek);
            const workout = schedule[state.selectedDay];
            const dayKey = `${state.currentWeek}-${state.selectedDay}`;
            let completed = state.completedExercises[dayKey] || [];
            
            // Validate: only show exercises that actually exist in this workout
            const validExercises = workout.exercises.map(ex => ex.name);
            completed = completed.filter(name => validExercises.includes(name));
            
            // Update storage if we cleaned up any phantom completions
            if (completed.length !== (state.completedExercises[dayKey] || []).length) {
                state.completedExercises[dayKey] = completed;
                saveState();
            }
            
            const completedCount = completed.length;
            const totalExercises = workout.exercises.length;
            const progress = (completedCount / totalExercises) * 100;
            const dayDate = getDayDate(state.currentWeek, state.selectedDay);
            
            setTimeout(() => window.scrollTo(0, 0), 0);
            
            app.innerHTML = `
                <div class="sticky-header shadow-xl">
                    <div class="p-4">
                        <button onclick="backToOverview()" class="mb-3 px-4 py-2 text-slate-300 hover:text-white hover:bg-slate-700/30 rounded-lg text-sm">
                            â† Back
                        </button>
                        <div class="flex justify-between items-center gap-3">
                            <div class="flex-1 min-w-0">
                                <div class="flex items-baseline gap-2 mb-1">
                                    <h2 class="text-xl font-bold capitalize">${state.selectedDay}</h2>
                                    <span class="text-sm text-slate-400">${dayDate}</span>
                                </div>
                                <p class="text-base text-blue-400 font-medium">${workout.name}</p>
                                <p class="text-xs text-slate-400 mt-1">${workout.duration} â€¢ ${workout.location}</p>
                                ${workout.note ? `<p class="text-xs text-yellow-400 mt-1">âš ï¸ ${workout.note}</p>` : ''}
                                ${workout.equipmentNeeded ? `
                                    <p class="text-xs text-yellow-400 mt-1">ðŸ“¦ ${workout.equipmentNeeded.join(', ')}</p>
                                ` : ''}
                            </div>
                            <div class="flex-shrink-0">
                                ${renderProgressRing(Math.round(progress), `${completedCount}/${totalExercises}`, 'ring-week', false)}
                            </div>
                        </div>
                    </div>
                </div>

                <div class="p-5 space-y-4">
                    ${workout.exercises.map((exercise, exIndex) => {
                        const isCompleted = completed.includes(exercise.name);
                        const muscles = getMuscleGroups(exercise.name);
                        
                        return `
                            <div class="bg-slate-800 rounded-lg p-5 border border-slate-700 shadow-md">
                                <div class="flex justify-between items-start mb-3">
                                    <div class="flex-1 pr-3">
                                        <div class="flex items-start flex-wrap gap-1">
                                            <h3 class="text-lg font-bold ${isCompleted ? 'text-green-400' : 'text-white'} inline">
                                                ${exercise.name}
                                            </h3>
                                            ${muscles.primary.length > 0 ? `<div class="inline-flex gap-1 items-center">${muscles.primary.map(m => 
                                                `<span class="muscle-tag primary-muscle">${m}</span>`
                                            ).join('')}</div>` : ''}
                                            ${muscles.secondary.length > 0 ? `<div class="inline-flex gap-1 items-center">${muscles.secondary.slice(0, 2).map(m => 
                                                `<span class="muscle-tag secondary-muscle">${m}</span>`
                                            ).join('')}</div>` : ''}
                                        </div>
                                        <p class="text-sm text-slate-400 mt-1">
                                            ${exercise.sets} sets Ã— ${exercise.reps}
                                            ${exercise.rest ? ` â€¢ ${exercise.rest} rest` : ''}
                                        </p>
                                    </div>
                                    <button onclick="toggleExercise('${exercise.name}')" class="ml-2 text-2xl flex-shrink-0">
                                        ${isCompleted ? 'âœ”ï¸' : 'â­•'}
                                    </button>
                                </div>
                                
                                ${exercise.hasWeight ? `
                                    <div class="mt-3 pt-3 border-t border-slate-700">
                                        <div class="grid grid-cols-${exercise.sets === 5 ? '5' : Math.min(exercise.sets, 4)} gap-2">
                                            ${Array.from({ length: exercise.sets }, (_, i) => {
                                                const weight = getSmartRecommendation(exercise.name, i, state.currentWeek);
                                                const equipment = getEquipmentType(exercise.name);
                                                
                                                return `
                                                    <div class="text-center">
                                                        <div class="text-xs text-slate-500 mb-1">Set ${i + 1}</div>
                                                        ${state.editingSet === `${exercise.name}-${i}` ? `
                                                            <input 
                                                                type="number" 
                                                                inputmode="decimal"
                                                                value="${state.tempWeight}"
                                                                onchange="saveWeight('${exercise.name}', ${i}, this.value, ${exercise.sets})"
                                                                onblur="cancelEdit()"
                                                                class="w-full px-2 py-1 bg-slate-700 border border-blue-500 rounded text-center text-white"
                                                                autofocus
                                                                id="weight-input-${exercise.name}-${i}"
                                                            />
                                                        ` : `
                                                            <div class="flex items-center justify-center gap-1">
                                                                <span class="text-lg font-bold text-blue-400">${weight}</span>
                                                                <button 
                                                                    onclick="event.stopPropagation(); startEdit('${exercise.name}', ${i}, ${weight})"
                                                                    class="text-slate-500 hover:text-blue-400 text-sm"
                                                                >âœï¸</button>
                                                            </div>
                                                        `}
                                                        <div class="text-xs text-slate-600">${equipment.type === 'box' ? 'in' : 'lbs'}</div>
                                                    </div>
                                                `;
                                            }).join('')}
                                        </div>
                                    </div>
                                ` : ''}
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
        }

        function renderSupplements(app) {
            const today = new Date().toISOString().split('T')[0];
            const dayLog = state.supplementLog[today] || {};
            const suppProgress = getTotalSupplementProgress();
            
            setTimeout(() => window.scrollTo(0, 0), 0);
            
            app.innerHTML = `
                <div class="sticky-header shadow-xl">
                    <div class="p-4">
                        <button onclick="backToOverview()" class="mb-3 px-4 py-2 text-slate-300 hover:text-white hover:bg-slate-700/30 rounded-lg text-sm">
                            â† Back
                        </button>
                        <div class="flex justify-between items-center gap-3">
                            <div class="flex-1 min-w-0">
                                <h2 class="text-xl font-bold">ðŸ’Š Daily Supplements</h2>
                                <p class="text-xs text-slate-400 mt-1">${new Date().toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric' })}</p>
                            </div>
                            <div class="flex-shrink-0">
                                ${renderProgressRing(suppProgress.percentage, `${suppProgress.completed}/${suppProgress.total}`, 'ring-supplement', false)}
                            </div>
                        </div>
                    </div>
                </div>

                <div class="p-5 space-y-6">
                    ${Object.entries(supplementSchedule).map(([timeKey, timeData]) => {
                        let supplements = timeData.supplements;
                        
                        if (timeKey === 'preworkout') {
                            const dayOfWeek = new Date().getDay();
                            if (dayOfWeek === 0) supplements = [];
                        }
                        
                        supplements = supplements.filter(supp => {
                            if (supp.conditional && supp.checkFunction) {
                                return supp.checkFunction();
                            }
                            return true;
                        });
                        
                        if (supplements.length === 0) return '';
                        
                        return `
                            <div class="bg-slate-800 rounded-lg p-4 border border-slate-700 shadow-md">
                                <div class="mb-3">
                                    <h3 class="text-lg font-bold text-purple-400">${timeData.time}</h3>
                                    <p class="text-xs text-slate-400">${timeData.note}</p>
                                </div>
                                
                                <div class="space-y-2">
                                    ${supplements.map(supp => {
                                        const suppKey = `${timeKey}-${supp.name}`;
                                        const taken = dayLog[suppKey] || false;
                                        
                                        return `
                                            <div class="flex items-center justify-between p-3 bg-slate-900 rounded-lg">
                                                <div class="flex items-center gap-3">
                                                    <span class="text-xl">${supp.icon}</span>
                                                    <div>
                                                        <p class="font-semibold ${taken ? 'text-green-400' : 'text-white'}">${supp.name}</p>
                                                        <p class="text-xs text-slate-400">${supp.dose}</p>
                                                    </div>
                                                </div>
                                                <button 
                                                    onclick="toggleSupplement('${timeKey}', '${supp.name}')"
                                                    class="text-2xl"
                                                >
                                                    ${taken ? 'âœ”ï¸' : 'â­•'}
                                                </button>
                                            </div>
                                        `;
                                    }).join('')}
                                </div>
                            </div>
                        `;
                    }).join('')}
                    
                    <div class="bg-blue-900 bg-opacity-30 rounded-lg p-4 border border-blue-700">
                        <p class="text-sm text-blue-300">
                            <strong>ðŸ’¡ Tip:</strong> Beta-Alanine is only on workout days (Mon-Sat). Collagen alternates every other day at 3 PM.
                        </p>
                    </div>
                </div>
            `;
        }

        function changeWeek(delta) {
            const newWeek = state.currentWeek + delta;
            if (newWeek >= 0 && newWeek <= 16) {
                state.currentWeek = newWeek;
                saveState();
                render();
                window.scrollTo(0, 0);
            }
        }

        function jumpToCurrentWeek() {
            state.currentWeek = getCurrentWeek();
            saveState();
            render();
        }

        function selectDay(day) {
            state.selectedDay = day;
            state.view = 'workout';
            history.pushState({ view: 'workout', day: day }, '', '');
            render();
        }

        function backToOverview() {
            state.view = 'overview';
            state.editingSet = null;
            history.pushState({ view: 'overview' }, '', '');
            render();
        }

        function showSupplements() {
            state.view = 'supplements';
            history.pushState({ view: 'supplements' }, '', '');
            render();
        }

        function toggleExercise(exerciseName) {
            const dayKey = `${state.currentWeek}-${state.selectedDay}`;
            if (!state.completedExercises[dayKey]) {
                state.completedExercises[dayKey] = [];
            }
            
            const index = state.completedExercises[dayKey].indexOf(exerciseName);
            const isNowCompleted = index === -1;
            
            if (index > -1) {
                state.completedExercises[dayKey].splice(index, 1);
            } else {
                state.completedExercises[dayKey].push(exerciseName);
            }
            
            saveState();
            
            // Update UI without full re-render
            const completed = state.completedExercises[dayKey].length;
            const schedule = getWorkoutSchedule(state.currentWeek);
            const workout = schedule[state.selectedDay];
            const total = workout.exercises.length;
            const progress = Math.round((completed / total) * 100);
            
            // Update ring
            updateRingProgress('ring-week', progress, `${completed}/${total}`);
            
            // Update exercise styling
            const exercises = document.querySelectorAll('.bg-slate-800.rounded-lg.p-5');
            exercises.forEach(exerciseEl => {
                const titleEl = exerciseEl.querySelector('h3');
                if (titleEl && titleEl.textContent.includes(exerciseName)) {
                    const button = exerciseEl.querySelector('button[onclick*="toggleExercise"]');
                    if (button) {
                        button.textContent = isNowCompleted ? 'âœ”ï¸' : 'â­•';
                    }
                    if (isNowCompleted) {
                        titleEl.classList.add('text-green-400');
                        titleEl.classList.remove('text-white');
                    } else {
                        titleEl.classList.remove('text-green-400');
                        titleEl.classList.add('text-white');
                    }
                }
            });
        }

        function toggleSupplement(timeKey, suppName) {
            const today = new Date().toISOString().split('T')[0];
            if (!state.supplementLog[today]) {
                state.supplementLog[today] = {};
            }
            
            const suppKey = `${timeKey}-${suppName}`;
            const newState = !state.supplementLog[today][suppKey];
            state.supplementLog[today][suppKey] = newState;
            
            saveState();
            
            // Update ring in real-time
            const suppProgress = getTotalSupplementProgress();
            updateRingProgress('ring-supplement', suppProgress.percentage, `${suppProgress.completed}/${suppProgress.total}`);
            
            // Update supplement styling
            const suppElements = document.querySelectorAll('.bg-slate-900.rounded-lg');
            suppElements.forEach(el => {
                const nameEl = el.querySelector('.font-semibold');
                if (nameEl && nameEl.textContent === suppName) {
                    const button = el.querySelector('button');
                    if (button) {
                        button.textContent = newState ? 'âœ”ï¸' : 'â­•';
                    }
                    if (newState) {
                        nameEl.classList.add('text-green-400');
                        nameEl.classList.remove('text-white');
                    } else {
                        nameEl.classList.remove('text-green-400');
                        nameEl.classList.add('text-white');
                    }
                }
            });
        }

        function startEdit(exerciseName, setIndex, currentWeight) {
            const currentScrollPos = window.pageYOffset;
            state.editingSet = `${exerciseName}-${setIndex}`;
            state.tempWeight = currentWeight.toString();
            
            // Re-render only the exercise card
            const schedule = getWorkoutSchedule(state.currentWeek);
            const workout = schedule[state.selectedDay];
            const exercise = workout.exercises.find(ex => ex.name === exerciseName);
            
            if (exercise) {
                const exercises = document.querySelectorAll('.bg-slate-800.rounded-lg.p-5');
                exercises.forEach(exerciseEl => {
                    const titleEl = exerciseEl.querySelector('h3');
                    if (titleEl && titleEl.textContent.includes(exerciseName)) {
                        const weightGrid = exerciseEl.querySelector('.grid');
                        if (weightGrid) {
                            const setDivs = weightGrid.querySelectorAll('.text-center');
                            if (setDivs[setIndex]) {
                                const equipment = getEquipmentType(exerciseName);
                                setDivs[setIndex].innerHTML = `
                                    <div class="text-xs text-slate-500 mb-1">Set ${setIndex + 1}</div>
                                    <input 
                                        type="number" 
                                        inputmode="decimal"
                                        value="${currentWeight}"
                                        onchange="saveWeight('${exerciseName}', ${setIndex}, this.value, ${exercise.sets})"
                                        onblur="cancelEdit()"
                                        class="w-full px-2 py-1 bg-slate-700 border border-blue-500 rounded text-center text-white"
                                        autofocus
                                        id="weight-input-${exerciseName}-${setIndex}"
                                    />
                                    <div class="text-xs text-slate-600">${equipment.type === 'box' ? 'in' : 'lbs'}</div>
                                `;
                                
                                setTimeout(() => {
                                    const input = document.getElementById(`weight-input-${exerciseName}-${setIndex}`);
                                    if (input) {
                                        input.focus();
                                        const length = input.value.length;
                                        input.setSelectionRange(length, length);
                                        if (input.scrollLeft !== undefined) {
                                            input.scrollLeft = input.scrollWidth;
                                        }
                                    }
                                    window.scrollTo(0, currentScrollPos);
                                }, 50);
                            }
                        }
                    }
                });
            }
        }

        function saveWeight(exerciseName, setIndex, value, totalSets) {
            const currentScrollPos = window.pageYOffset;
            const newWeight = parseFloat(value);
            if (!isNaN(newWeight) && newWeight > 0) {
                const key = `${state.currentWeek}-${exerciseName}-${setIndex}`;
                state.exerciseWeights[key] = newWeight;
                updateFutureSets(exerciseName, setIndex, newWeight, state.currentWeek, totalSets);
                saveState();
            }
            
            state.editingSet = null;
            state.tempWeight = '';
            
            // Update the display without full re-render
            const exercises = document.querySelectorAll('.bg-slate-800.rounded-lg.p-5');
            exercises.forEach(exerciseEl => {
                const titleEl = exerciseEl.querySelector('h3');
                if (titleEl && titleEl.textContent.includes(exerciseName)) {
                    const weightGrid = exerciseEl.querySelector('.grid');
                    if (weightGrid) {
                        const setDivs = weightGrid.querySelectorAll('.text-center');
                        for (let i = setIndex; i < totalSets; i++) {
                            if (setDivs[i]) {
                                const weight = getSmartRecommendation(exerciseName, i, state.currentWeek);
                                const equipment = getEquipmentType(exerciseName);
                                setDivs[i].innerHTML = `
                                    <div class="text-xs text-slate-500 mb-1">Set ${i + 1}</div>
                                    <div class="flex items-center justify-center gap-1">
                                        <span class="text-lg font-bold text-blue-400">${weight}</span>
                                        <button 
                                            onclick="event.stopPropagation(); startEdit('${exerciseName}', ${i}, ${weight})"
                                            class="text-slate-500 hover:text-blue-400 text-sm"
                                        >âœï¸</button>
                                    </div>
                                    <div class="text-xs text-slate-600">${equipment.type === 'box' ? 'in' : 'lbs'}</div>
                                `;
                            }
                        }
                    }
                }
            });
            
            window.scrollTo(0, currentScrollPos);
        }

        function cancelEdit() {
            setTimeout(() => {
                if (state.editingSet) {
                    const currentScrollPos = window.pageYOffset;
                    state.editingSet = null;
                    state.tempWeight = '';
                    window.scrollTo(0, currentScrollPos);
                }
            }, 200);
        }

        window.addEventListener('popstate', function(event) {
            if (state.view !== 'overview') {
                backToOverview();
            }
        });

        history.replaceState({ view: 'overview' }, '', '');
        render();
    </script>
</body>
</html>
